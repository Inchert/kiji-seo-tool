<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KCI教育センター SEOキーワード分析ツール v4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="keyword-tool-v4.css">
    <style>
        .material-symbols-outlined { font-size: 20px; vertical-align: middle; }
        .icon-sm { font-size: 16px; }
        .icon-lg { font-size: 24px; }
        .icon-xl { font-size: 32px; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-indigo-50 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-6xl">

        <!-- ヘッダー -->
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2"><span class="text-indigo-600">KCI教育センター</span> SEOキーワード分析ツール <span class="text-sm bg-indigo-500 text-white px-2 py-1 rounded-full ml-2">v4</span></h1>
            <p class="text-gray-600">キーワード分析から記事構成・競合比較まで、SEO記事作成をワンストップで支援</p>
            <p class="text-xs text-gray-400 mt-1">kensetsu-mikata.jp 専用 | Excel出力・クラスター編集・競合ヒートマップ・データ保存/復元対応</p>
        </header>

        <!-- ステップインジケーター -->
        <div class="flex justify-center gap-2 mb-8 flex-wrap">
            <div id="step-indicator-1" class="flex items-center gap-2 px-4 py-2 rounded-full bg-indigo-600 text-white text-sm font-medium">
                <span class="w-6 h-6 rounded-full bg-white text-indigo-600 flex items-center justify-center text-xs font-bold">1</span>
                データ入力
            </div>
            <div class="flex items-center text-gray-300">→</div>
            <div id="step-indicator-2" class="flex items-center gap-2 px-4 py-2 rounded-full bg-gray-200 text-gray-500 text-sm font-medium">
                <span class="w-6 h-6 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-xs font-bold">2</span>
                分析結果
            </div>
            <div class="flex items-center text-gray-300">→</div>
            <div id="step-indicator-3" class="flex items-center gap-2 px-4 py-2 rounded-full bg-gray-200 text-gray-500 text-sm font-medium">
                <span class="w-6 h-6 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-xs font-bold">3</span>
                記事設計
            </div>
        </div>

        <!-- メインコンテンツ -->
        <div id="main-content">

            <!-- STEP 1: データ入力 -->
            <div id="step-1" class="fade-in">
                <div class="glass-card rounded-2xl shadow-xl p-8 mb-6">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 rounded-full bg-indigo-600 text-white flex items-center justify-center font-bold">1</div>
                        <div>
                            <h2 class="text-xl font-bold text-gray-800">キーワードデータを入力</h2>
                            <p class="text-sm text-gray-500">ラッコキーワード → キーワードプランナー → CSV取り込み</p>
                        </div>
                    </div>

                    <!-- ビッグキーワード候補（STEP 0） -->
                    <div class="bg-gradient-to-r from-slate-50 to-indigo-50 border-2 border-indigo-200 rounded-xl p-5 mb-6">
                        <h3 class="font-bold text-indigo-800 mb-3 flex items-center gap-2">
                            <span class="material-symbols-outlined icon-lg">target</span>
                            STEP 0：検索すべきビッグキーワードを確認
                        </h3>
                        <p class="text-xs text-indigo-700 mb-4">教育テーマを選ぶと、ラッコキーワードで検索すべきキーワードバリエーションが表示されます。全てのバリエーションで検索すると、関連キーワードを漏れなく取得できます。</p>

                        <!-- テーマ選択 -->
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-indigo-800 mb-2">教育テーマを選択</label>
                            <select id="big-keyword-theme" onchange="showBigKeywordVariations()" class="w-full p-3 border-2 border-indigo-200 rounded-lg bg-white text-sm">
                                <option value="">-- テーマを選んでください --</option>
                                <optgroup label="優先度：高（検索ボリューム大）">
                                    <option value="職長">職長・安全衛生責任者教育</option>
                                    <option value="フルハーネス">フルハーネス型墜落制止用器具特別教育</option>
                                    <option value="足場">足場の組立て等特別教育</option>
                                    <option value="玉掛け">玉掛け技能講習</option>
                                    <option value="フォークリフト">フォークリフト運転技能講習</option>
                                </optgroup>
                                <optgroup label="優先度：中">
                                    <option value="酸欠">酸素欠乏・硫化水素危険作業特別教育</option>
                                    <option value="低圧電気">低圧電気取扱特別教育</option>
                                    <option value="粉じん">粉じん作業特別教育</option>
                                    <option value="石綿">石綿取扱い作業従事者特別教育</option>
                                    <option value="高所作業車">高所作業車運転特別教育</option>
                                    <option value="クレーン">クレーン運転特別教育</option>
                                    <option value="アーク溶接">アーク溶接等作業特別教育</option>
                                    <option value="小型車両系">小型車両系建設機械運転特別教育</option>
                                </optgroup>
                                <optgroup label="優先度：低">
                                    <option value="丸のこ">丸のこ等取扱作業従事者教育</option>
                                    <option value="研削砥石">研削砥石取替試運転業務特別教育</option>
                                    <option value="刈払機">刈払機取扱作業者安全衛生教育</option>
                                    <option value="振動工具">振動工具取扱作業者安全衛生教育</option>
                                    <option value="ロープ高所">ロープ高所作業特別教育</option>
                                    <option value="ゴンドラ">ゴンドラ取扱特別教育</option>
                                    <option value="巻上げ機">巻上げ機運転特別教育</option>
                                </optgroup>
                            </select>
                        </div>

                        <!-- ボリュームフィルター -->
                        <div class="mb-4 p-3 bg-white rounded-lg border border-indigo-200">
                            <label class="block text-sm font-semibold text-indigo-800 mb-2">
                                <span class="material-symbols-outlined icon-sm" style="vertical-align: middle;">filter_alt</span>
                                ボリュームで絞り込み
                            </label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="volume-filter-min" placeholder="最小" min="0" step="100"
                                    class="w-24 p-2 border border-gray-300 rounded text-sm" onchange="showBigKeywordVariations()">
                                <span class="text-gray-500">〜</span>
                                <input type="number" id="volume-filter-max" placeholder="最大" min="0" step="100"
                                    class="w-24 p-2 border border-gray-300 rounded text-sm" onchange="showBigKeywordVariations()">
                                <span class="text-xs text-gray-500">/月</span>
                                <button type="button" onclick="clearVolumeFilter()" class="text-xs text-indigo-500 hover:text-indigo-700 underline ml-2">クリア</button>
                                <span id="volume-filter-info" class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded hidden ml-auto"></span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">例：500〜2000で中規模キーワードを抽出</p>
                        </div>

                        <!-- キーワードバリエーション表示エリア -->
                        <div id="big-keyword-variations" class="hidden">
                            <div class="bg-white rounded-lg p-4 border border-indigo-200">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 id="big-keyword-theme-name" class="font-bold text-gray-800"></h4>
                                    <span id="big-keyword-total-volume" class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full"></span>
                                </div>
                                <p class="text-xs text-gray-500 mb-3">以下のキーワードを全てラッコキーワードで検索してください：</p>
                                <div id="big-keyword-list" class="space-y-2"></div>
                                <div class="mt-4 pt-4 border-t border-gray-200 flex gap-2">
                                    <button type="button" onclick="copyBigKeywords()" class="flex-1 bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-semibold">
                                        全キーワードをコピー
                                    </button>
                                    <a href="https://related-keywords.com/" target="_blank" class="flex-1 bg-indigo-600 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-semibold text-center">
                                        ラッコキーワードを開く
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- フローガイド -->
                    <div class="bg-gradient-to-r from-indigo-50 to-slate-50 border border-indigo-200 rounded-xl p-5 mb-6">
                        <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                            推奨フロー（実ボリューム取得）
                        </h3>
                        <div class="grid md:grid-cols-3 gap-4">
                            <!-- STEP 1 -->
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="w-6 h-6 rounded-full bg-indigo-600 text-white text-xs flex items-center justify-center font-bold">1</span>
                                    <span class="font-semibold text-indigo-800">サジェスト取得</span>
                                </div>
                                <ol class="text-xs text-gray-600 space-y-1 ml-8">
                                    <li>• <a href="https://related-keywords.com/" target="_blank" class="text-indigo-600 underline">ラッコキーワード</a>で検索</li>
                                    <li>• 「全キーワードコピー」</li>
                                </ol>
                            </div>
                            <!-- STEP 2 -->
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="w-6 h-6 rounded-full bg-indigo-500 text-white text-xs flex items-center justify-center font-bold">2</span>
                                    <span class="font-semibold text-indigo-700">ボリューム取得</span>
                                </div>
                                <ol class="text-xs text-gray-600 space-y-1 ml-8">
                                    <li>• <a href="https://ads.google.com/aw/keywordplanner/home" target="_blank" class="text-indigo-500 underline">キーワードプランナー</a>を開く</li>
                                    <li>• 「検索ボリュームと予測」に貼り付け</li>
                                    <li>• 右上「ダウンロード」→「過去のプラン指標」→「.csv」</li>
                                </ol>
                            </div>
                            <!-- STEP 3 -->
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="w-6 h-6 rounded-full bg-indigo-600 text-white text-xs flex items-center justify-center font-bold">3</span>
                                    <span class="font-semibold text-indigo-800">CSV取り込み</span>
                                </div>
                                <ol class="text-xs text-gray-600 space-y-1 ml-8">
                                    <li>• 下のエリアにCSVをドロップ</li>
                                    <li>• 「分析開始」をクリック</li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <!-- CSVファイル選択エリア -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">キーワードプランナーCSVファイル</label>
                        <div id="csv-dropzone" class="w-full h-40 border-2 border-dashed border-indigo-300 rounded-xl flex flex-col items-center justify-center bg-indigo-50 hover:bg-indigo-100 cursor-pointer transition-colors">
                            <svg class="w-12 h-12 text-indigo-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                            <p class="text-indigo-700 font-medium">CSVファイルをドロップ、またはクリックして選択</p>
                            <p class="text-indigo-500 text-xs mt-1">キーワードプランナーからダウンロードした「過去のプラン指標.csv」</p>
                            <input type="file" id="csv-file-input" accept=".csv" class="hidden">
                        </div>
                        <div id="csv-file-info" class="hidden mt-4 p-4 bg-indigo-100 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <svg class="w-8 h-8 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                    <div>
                                        <p id="csv-filename" class="font-medium text-indigo-700">ファイル名</p>
                                        <p id="csv-rowcount" class="text-sm text-indigo-500">0行</p>
                                    </div>
                                </div>
                                <button type="button" onclick="clearCSVFile()" class="text-slate-500 hover:text-slate-700">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- または簡易モード -->
                    <div class="border-t border-gray-200 pt-6 mt-6">
                        <details class="group">
                            <summary class="cursor-pointer text-sm text-gray-500 hover:text-gray-700 flex items-center gap-2">
                                <svg class="w-4 h-4 transition-transform group-open:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                CSVがない場合（推定ボリュームで分析）
                            </summary>
                            <div class="mt-4">
                                <textarea id="keyword-input" class="w-full h-48 p-4 border-2 border-gray-200 rounded-xl text-sm focus:border-indigo-500 resize-none" placeholder="ラッコキーワードからコピーしたキーワードを貼り付け（1行に1キーワード）

例：
職長教育
職長教育 オンライン
職長教育 費用
..."></textarea>
                                <p class="text-xs text-gray-500 mt-2">※ボリュームは推定値が自動で割り当てられます（精度は低め）</p>
                            </div>
                        </details>
                    </div>

                    <!-- 分析ボタン -->
                    <div class="flex flex-col sm:flex-row gap-4 justify-between items-center mt-6">
                        <button type="button" onclick="loadSampleData()" class="text-sm text-gray-500 hover:text-indigo-600 underline cursor-pointer">サンプルデータで試す</button>
                        <button type="button" onclick="startAnalysis()" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold shadow-lg flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            分析開始
                        </button>
                    </div>
                </div>
            </div>

            <!-- STEP 2: 分析結果 -->
            <div id="step-2" class="hidden fade-in">
                <div class="glass-card rounded-2xl shadow-xl p-8 mb-6">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-indigo-500 text-white flex items-center justify-center font-bold">2</div>
                            <div>
                                <h2 class="text-xl font-bold text-gray-800">分析結果</h2>
                                <p class="text-sm text-gray-500">キーワードが自動でグループ分けされました</p>
                            </div>
                        </div>
                        <button type="button" onclick="goToStep(1)" class="text-sm text-gray-500 hover:text-indigo-600 flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            戻る
                        </button>
                    </div>

                    <!-- サマリー -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                        <div class="bg-gradient-to-br from-indigo-600 to-indigo-700 rounded-xl p-4 text-white text-center shadow-lg">
                            <div class="text-3xl font-bold" id="summary-keywords">0</div>
                            <div class="text-sm opacity-90">キーワード数</div>
                        </div>
                        <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-xl p-4 text-white text-center shadow-md">
                            <div class="text-3xl font-bold" id="summary-clusters">0</div>
                            <div class="text-sm opacity-90">グループ数</div>
                        </div>
                        <div class="bg-gradient-to-br from-indigo-400 to-indigo-500 rounded-xl p-4 text-white text-center shadow-md">
                            <div class="text-3xl font-bold" id="summary-articles">0</div>
                            <div class="text-sm opacity-90">推奨記事数</div>
                        </div>
                        <div class="bg-gradient-to-br from-slate-500 to-slate-600 rounded-xl p-4 text-white text-center shadow-md">
                            <div class="text-3xl font-bold" id="summary-priority">0</div>
                            <div class="text-sm opacity-90">高優先グループ</div>
                        </div>
                    </div>

                    <!-- グループ一覧 -->
                    <h3 class="font-bold text-gray-700 mb-4">グループ一覧 <span class="text-sm font-normal text-gray-500">（クリックで記事設計へ）</span></h3>
                    <div id="cluster-list" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                        <!-- 動的に生成 -->
                    </div>

                    <!-- 優先度TOP20 -->
                    <h3 class="font-bold text-gray-700 mb-4">優先度TOP20キーワード</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-3 text-left rounded-tl-lg">順位</th>
                                    <th class="p-3 text-left">キーワード</th>
                                    <th class="p-3 text-center">推定Vol</th>
                                    <th class="p-3 text-center">検索意図</th>
                                    <th class="p-3 text-center">CV期待</th>
                                    <th class="p-3 text-center rounded-tr-lg">一次情報</th>
                                </tr>
                            </thead>
                            <tbody id="priority-table">
                                <!-- 動的に生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- エクスポートボタン（v4拡張） -->
                <div class="flex flex-wrap justify-center gap-3 mb-6">
                    <button type="button" onclick="openExportModal()" class="bg-indigo-500 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg text-sm flex items-center gap-2 font-medium">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        エクスポート
                    </button>
                    <button type="button" onclick="openImportModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg text-sm flex items-center gap-2 font-medium">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                        インポート
                    </button>
                    <button type="button" onclick="exportCSV()" class="bg-white border border-gray-300 px-6 py-2 rounded-lg text-sm hover:bg-gray-50 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        CSV出力
                    </button>
                    <button type="button" onclick="saveData()" class="bg-white border border-gray-300 px-6 py-2 rounded-lg text-sm hover:bg-gray-50 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                        保存
                    </button>
                    <button type="button" onclick="openClusterEditModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg text-sm flex items-center gap-2 font-medium">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                        クラスター編集
                    </button>
                </div>
            </div>

            <!-- STEP 3: 記事設計（競合分析タブ含む） -->
            <div id="step-3" class="hidden fade-in">
                <div class="glass-card rounded-2xl shadow-xl p-8 mb-6">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-indigo-600 text-white flex items-center justify-center font-bold">3</div>
                            <div>
                                <h2 class="text-xl font-bold text-gray-800">記事設計</h2>
                                <p class="text-sm text-gray-500" id="selected-cluster-name">グループを選択してください</p>
                            </div>
                        </div>
                        <button type="button" onclick="goToStep(2)" class="text-sm text-gray-500 hover:text-indigo-600 flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            結果に戻る
                        </button>
                    </div>

                    <!-- メインタブナビゲーション -->
                    <div class="flex gap-2 mb-6 border-b border-gray-200">
                        <button type="button" onclick="showArticleMainTab('design')" class="article-main-tab-btn px-6 py-3 rounded-t-lg text-sm font-semibold bg-indigo-100 text-indigo-700 border-b-2 border-indigo-600" data-tab="design">
                            <span class="material-symbols-outlined icon-sm">edit_note</span> 構成作成
                        </button>
                        <button type="button" onclick="showArticleMainTab('competitor')" class="article-main-tab-btn px-6 py-3 rounded-t-lg text-sm font-semibold bg-gray-100 text-gray-600 border-b-2 border-transparent hover:bg-gray-200" data-tab="competitor">
                            <span class="material-symbols-outlined icon-sm">target</span> 競合分析（任意）
                        </button>
                    </div>

                    <!-- タブコンテンツ: 構成作成 -->
                    <div id="article-main-tab-design" class="article-main-tab-content">

                    <!-- 記事タイプ選択 -->
                    <div class="mb-6">
                        <label class="block font-semibold text-gray-700 mb-3">記事タイプを選択</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="pillar" checked class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">menu_book</span> ピラー記事</div>
                                    <div class="text-xs text-gray-500 mt-1">総合ガイド・完全解説</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: SEO基盤構築、内部リンクのハブ</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="howto" class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">list_alt</span> ハウツー</div>
                                    <div class="text-xs text-gray-500 mt-1">手順解説・申込み方法</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: 申込導線に直結、CV率高</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="comparison" class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">trophy</span> 選び方ガイド</div>
                                    <div class="text-xs text-gray-500 mt-1">講座紹介・自社推し</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: 比較検討層を獲得、差別化</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="faq" class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">help</span> FAQ形式</div>
                                    <div class="text-xs text-gray-500 mt-1">Q&A・よくある質問</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: 強調スニペット獲得、音声検索対応</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="case" class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">work</span> 事例・体験談</div>
                                    <div class="text-xs text-gray-500 mt-1">受講者の声・活用事例</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: 信頼性UP、E-E-A-T強化</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="glossary" class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">dictionary</span> 用語解説</div>
                                    <div class="text-xs text-gray-500 mt-1">〇〇とは・基礎知識</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: 検索流入増、初心者獲得</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="checklist" class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">checklist</span> チェックリスト</div>
                                    <div class="text-xs text-gray-500 mt-1">準備・持ち物・確認事項</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: 実用性高、ブックマーク獲得</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="news" class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">newspaper</span> 法改正・ニュース</div>
                                    <div class="text-xs text-gray-500 mt-1">最新情報・制度変更</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: 専門性アピール、リピーター獲得</div>
                                </div>
                            </label>
                        </div>
                        <!-- 記事タイプ効果サマリー -->
                        <div class="mt-4 p-3 bg-slate-50 border border-indigo-200 rounded-lg text-xs text-indigo-800">
                            <strong><span class="material-symbols-outlined icon-sm">lightbulb</span> 選び方のコツ：</strong>
                            CV重視なら「ハウツー」「選び方ガイド」、SEO基盤なら「ピラー記事」「用語解説」、信頼性なら「事例」「法改正」がおすすめ
                        </div>
                    </div>

                    <div class="mb-6">
                        <a href="javascript:void(0)" id="generate-article-btn" onclick="generateArticleDesign(); return false;" class="btn-success text-white px-6 py-3 rounded-xl font-semibold w-full block text-center cursor-pointer" style="display: block;">
                            記事構成を生成
                        </a>
                    </div>

                    <!-- 生成結果 -->
                    <div id="article-design-result" class="hidden">
                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- 左カラム：構成案 -->
                            <div>
                                <h3 class="font-bold text-gray-700 mb-3 flex items-center gap-2">
                                    <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                    記事構成案
                                </h3>
                                <!-- 構成表示切替タブ -->
                                <div class="flex gap-2 mb-3">
                                    <button type="button" onclick="showOutlineTab('basic')" class="outline-tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-600" data-tab="basic">
                                        <span class="material-symbols-outlined icon-sm">description</span> 基本構成
                                    </button>
                                    <button type="button" onclick="showOutlineTab('integrated')" class="outline-tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-indigo-100 text-indigo-700" data-tab="integrated">
                                        <span class="material-symbols-outlined icon-sm">auto_awesome</span> SEO統合版
                                    </button>
                                </div>
                                <!-- 基本構成 -->
                                <div id="article-outline-basic" class="outline-tab-content hidden">
                                    <div id="article-outline" class="bg-gray-50 rounded-xl p-4 text-sm whitespace-pre-wrap font-mono"></div>
                                </div>
                                <!-- SEO統合版 -->
                                <div id="article-outline-integrated-container" class="outline-tab-content">
                                    <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-3 mb-3 text-sm text-indigo-800">
                                        <span class="material-symbols-outlined icon-sm">info</span>
                                        <strong>SEO統合版</strong>：CTA・内部リンク・E-E-A-T要素が記事構成に直接組み込まれています。このままWordPressに貼り付けるとプレビューできます。
                                    </div>
                                    <div id="article-outline-integrated" class="bg-white rounded-xl p-4 text-sm border border-gray-200 overflow-auto max-h-[600px]"></div>
                                </div>
                            </div>

                            <!-- 右カラム：タイトル・メタ -->
                            <div class="space-y-4">
                                <div>
                                    <h3 class="font-bold text-gray-700 mb-3">SEOタイトル案</h3>
                                    <div id="title-suggestions" class="space-y-2"></div>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-700 mb-3">メタディスクリプション</h3>
                                    <div id="meta-description" class="bg-gray-50 rounded-xl p-4 text-sm"></div>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-700 mb-3">参照すべき一次情報</h3>
                                    <div id="primary-sources" class="space-y-2"></div>
                                </div>
                            </div>
                        </div>

                        <!-- プロ向けSEO戦略セクション -->
                        <div class="mt-8 border-t pt-8">
                            <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                                プロ向けSEO戦略
                            </h3>

                            <!-- タブナビゲーション -->
                            <div class="flex flex-wrap gap-2 mb-4">
                                <button type="button" onclick="showProTab('eeat')" class="pro-tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-indigo-100 text-indigo-700" data-tab="eeat">E-E-A-T</button>
                                <button type="button" onclick="showProTab('cta')" class="pro-tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-600" data-tab="cta">CTA設計</button>
                                <button type="button" onclick="showProTab('links')" class="pro-tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-600" data-tab="links">内部リンク</button>
                                <button type="button" onclick="showProTab('schema')" class="pro-tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-600" data-tab="schema">構造化データ</button>
                                <button type="button" onclick="showProTab('diff')" class="pro-tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-600" data-tab="diff">AI差別化</button>
                            </div>

                            <!-- タブコンテンツ -->
                            <div id="pro-tab-eeat" class="pro-tab-content bg-indigo-50 rounded-xl p-4">
                                <pre id="pro-tips-eeat" class="text-sm whitespace-pre-wrap font-mono text-indigo-900"></pre>
                            </div>
                            <div id="pro-tab-cta" class="pro-tab-content hidden bg-indigo-50 rounded-xl p-4">
                                <pre id="pro-tips-cta" class="text-sm whitespace-pre-wrap font-mono text-slate-900"></pre>
                            </div>
                            <div id="pro-tab-links" class="pro-tab-content hidden bg-indigo-50 rounded-xl p-4">
                                <pre id="pro-tips-links" class="text-sm whitespace-pre-wrap font-mono text-blue-900"></pre>
                            </div>
                            <div id="pro-tab-schema" class="pro-tab-content hidden bg-slate-50 rounded-xl p-4">
                                <pre id="pro-tips-schema" class="text-sm whitespace-pre-wrap font-mono text-slate-800"></pre>
                            </div>
                            <div id="pro-tab-diff" class="pro-tab-content hidden bg-slate-50 rounded-xl p-4">
                                <pre id="pro-tips-diff" class="text-sm whitespace-pre-wrap font-mono text-slate-800"></pre>
                            </div>
                        </div>

                        <!-- アクションボタン -->
                        <div class="mt-8 p-6 bg-gradient-to-r from-indigo-50 to-slate-50 rounded-xl">
                            <h3 class="font-bold text-gray-800 mb-4 text-center">次のアクション</h3>

                            <!-- AI選択 -->
                            <div class="mb-4">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">使用するAIを選択</label>
                                <div class="grid grid-cols-3 gap-2">
                                    <label class="cursor-pointer">
                                        <input type="radio" name="ai-select" value="claude" class="hidden peer" checked>
                                        <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 text-center transition-all">
                                            <div class="text-2xl mb-1"><span class="material-symbols-outlined icon-xl text-indigo-600">smart_toy</span></div>
                                            <div class="font-semibold text-sm text-indigo-700">Claude</div>
                                        </div>
                                    </label>
                                    <label class="cursor-pointer">
                                        <input type="radio" name="ai-select" value="chatgpt" class="hidden peer">
                                        <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 text-center transition-all">
                                            <div class="text-2xl mb-1"><span class="material-symbols-outlined icon-xl text-indigo-500">psychology</span></div>
                                            <div class="font-semibold text-sm text-indigo-700">ChatGPT</div>
                                        </div>
                                    </label>
                                    <label class="cursor-pointer">
                                        <input type="radio" name="ai-select" value="gemini" class="hidden peer">
                                        <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 text-center transition-all">
                                            <div class="text-2xl mb-1"><span class="material-symbols-outlined icon-xl text-indigo-400">auto_awesome</span></div>
                                            <div class="font-semibold text-sm text-indigo-700">Gemini</div>
                                        </div>
                                    </label>
                                </div>
                            </div>

                            <div class="grid md:grid-cols-2 gap-4">
                                <button type="button" onclick="copyForAI()" class="bg-white border-2 border-indigo-300 px-6 py-4 rounded-xl hover:bg-indigo-50 text-left">
                                    <div class="font-semibold text-indigo-700 mb-1">AIで本文を作成</div>
                                    <div class="text-xs text-gray-500">構成案を選択したAIに渡すプロンプトをコピー</div>
                                </button>
                                <button type="button" onclick="copyOutline()" class="bg-white border-2 border-indigo-300 px-6 py-4 rounded-xl hover:bg-indigo-50 text-left">
                                    <div class="font-semibold text-indigo-700 mb-1">構成案をコピー</div>
                                    <div class="text-xs text-gray-500">見出し・タイトル・一次情報をまとめてコピー</div>
                                </button>
                            </div>
                        </div>
                    </div>
                    </div><!-- /article-main-tab-design -->

                    <!-- タブコンテンツ: 競合分析 -->
                    <div id="article-main-tab-competitor" class="article-main-tab-content hidden">
                        <!-- 使い方ガイド -->
                        <div class="bg-gradient-to-r from-slate-50 to-indigo-50 border border-slate-300 rounded-xl p-4 mb-6">
                            <h3 class="font-semibold text-slate-700 mb-3 flex items-center gap-2">
                                <span class="material-symbols-outlined icon-sm">target</span> 検索1位を取るための競合分析（任意）
                            </h3>
                            <p class="text-xs text-gray-600 mb-3">競合の見出しを分析して、より良い記事構成を作成できます。スキップして構成作成タブに進むことも可能です。</p>
                            <div class="grid md:grid-cols-4 gap-3 text-sm">
                                <div class="bg-white rounded-lg p-3">
                                    <div class="font-bold text-slate-700 mb-1">① 検索</div>
                                    <div class="text-gray-600 text-xs">対象キーワードでGoogle検索</div>
                                </div>
                                <div class="bg-white rounded-lg p-3">
                                    <div class="font-bold text-slate-700 mb-1">② 見出し取得</div>
                                    <div class="text-gray-600 text-xs">上位3サイトを開いてH2/H3をコピー</div>
                                </div>
                                <div class="bg-white rounded-lg p-3">
                                    <div class="font-bold text-slate-700 mb-1">③ 貼り付け</div>
                                    <div class="text-gray-600 text-xs">下のエリアに見出しを貼り付け</div>
                                </div>
                                <div class="bg-white rounded-lg p-3">
                                    <div class="font-bold text-slate-700 mb-1">④ 分析</div>
                                    <div class="text-gray-600 text-xs">必須見出し・差別化ポイントを抽出</div>
                                </div>
                            </div>
                            <p class="text-xs text-slate-600 mt-3"><span class="material-symbols-outlined icon-sm">lightbulb</span> 見出しの取得方法：記事ページで右クリック→「検証」→見出しタグ（h2, h3）をコピー、または目次があればそれをコピー</p>
                        </div>

                        <!-- 競合サイト見出し入力（3サイト分） -->
                        <div class="space-y-4 mb-6">
                            <!-- 競合サイト1 -->
                            <div class="border-2 border-indigo-300 rounded-xl p-4 bg-indigo-50">
                                <div class="flex items-center gap-2 mb-3">
                                    <span class="w-8 h-8 rounded-full bg-indigo-500 text-white flex items-center justify-center font-bold">1</span>
                                    <span class="font-bold text-indigo-800">1位サイト</span>
                                    <input type="text" id="comp-1-title" class="flex-1 p-2 border rounded-lg text-sm" placeholder="サイト名/タイトル（任意）">
                                </div>
                                <textarea id="comp-1-headings" class="w-full h-32 p-3 border-2 border-indigo-200 rounded-xl text-sm resize-none" placeholder="見出しを貼り付け（1行1見出し）

例：
職長教育とは
職長教育の受講対象者
職長教育のカリキュラム
受講方法と費用
オンラインで受講する方法
よくある質問"></textarea>
                            </div>

                            <!-- 競合サイト2 -->
                            <div class="border-2 border-gray-200 rounded-xl p-4">
                                <div class="flex items-center gap-2 mb-3">
                                    <span class="w-8 h-8 rounded-full bg-gray-400 text-white flex items-center justify-center font-bold">2</span>
                                    <span class="font-bold text-gray-700">2位サイト</span>
                                    <input type="text" id="comp-2-title" class="flex-1 p-2 border rounded-lg text-sm" placeholder="サイト名/タイトル（任意）">
                                </div>
                                <textarea id="comp-2-headings" class="w-full h-32 p-3 border-2 border-gray-200 rounded-xl text-sm resize-none" placeholder="見出しを貼り付け（1行1見出し）"></textarea>
                            </div>

                            <!-- 競合サイト3 -->
                            <div class="border-2 border-gray-200 rounded-xl p-4">
                                <div class="flex items-center gap-2 mb-3">
                                    <span class="w-8 h-8 rounded-full bg-gray-400 text-white flex items-center justify-center font-bold">3</span>
                                    <span class="font-bold text-gray-700">3位サイト</span>
                                    <input type="text" id="comp-3-title" class="flex-1 p-2 border rounded-lg text-sm" placeholder="サイト名/タイトル（任意）">
                                </div>
                                <textarea id="comp-3-headings" class="w-full h-32 p-3 border-2 border-gray-200 rounded-xl text-sm resize-none" placeholder="見出しを貼り付け（1行1見出し）"></textarea>
                            </div>
                        </div>

                        <!-- 分析実行ボタン -->
                        <button type="button" onclick="analyzeCompetitorHeadings()" class="w-full bg-indigo-700 hover:bg-indigo-800 text-white px-6 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 mb-6">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                            競合を分析して勝てる構成を作る
                        </button>

                        <!-- 分析結果 -->
                        <div id="competitor-analysis-result" class="hidden">
                            <!-- 必須見出し（競合共通） -->
                            <div class="mb-6">
                                <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                                    <span class="material-symbols-outlined icon-sm text-indigo-600">priority_high</span> 必須見出し（競合が共通で書いている内容）
                                </h3>
                                <p class="text-xs text-gray-500 mb-3">これらの見出しは上位表示に必須。必ず記事に含めてください。</p>
                                <div id="must-have-headings" class="space-y-2"></div>
                            </div>

                            <!-- 差別化見出し候補 -->
                            <div class="mb-6">
                                <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                                    <span class="material-symbols-outlined icon-sm text-indigo-500">add_circle</span> 差別化見出し（一部の競合だけが書いている）
                                </h3>
                                <p class="text-xs text-gray-500 mb-3">取り入れると網羅性UP。競合を超える武器になります。</p>
                                <div id="diff-headings" class="space-y-2"></div>
                            </div>

                            <!-- KCI独自の強み提案 -->
                            <div class="mb-6 bg-indigo-50 rounded-xl p-4">
                                <h3 class="font-bold text-indigo-800 mb-3 flex items-center gap-2">
                                    <span class="material-symbols-outlined icon-sm text-indigo-400">star</span> KCI独自の差別化ポイント（競合にない強み）
                                </h3>
                                <p class="text-xs text-indigo-600 mb-3">これらを追加すれば、競合を圧倒できます。</p>
                                <div id="kci-unique-headings" class="space-y-2"></div>
                            </div>

                            <!-- 推奨見出し構成 -->
                            <div class="mb-6 bg-gradient-to-r from-indigo-50 to-slate-50 rounded-xl p-4 border-2 border-indigo-200">
                                <h3 class="font-bold text-indigo-800 mb-3 flex items-center gap-2">
                                    <span class="material-symbols-outlined icon-sm text-indigo-600">assignment</span> 1位を取るための推奨見出し構成
                                </h3>
                                <div id="recommended-structure" class="bg-white rounded-lg p-4 text-sm"></div>
                                <div class="flex gap-2 mt-4">
                                    <button type="button" onclick="copyRecommendedStructure()" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-semibold">
                                        構成をコピー
                                    </button>
                                    <button type="button" onclick="applyAndSwitchToDesign()" class="flex-1 bg-indigo-500 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-semibold">
                                        構成作成タブに反映
                                    </button>
                                </div>
                            </div>

                            <!-- 競合比較表 -->
                            <details class="mb-6">
                                <summary class="cursor-pointer font-bold text-gray-700 flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                    競合見出し比較表（詳細）
                                </summary>
                                <div id="comparison-table" class="mt-4 overflow-x-auto"></div>
                            </details>
                        </div>
                    </div><!-- /article-main-tab-competitor -->

                </div>
            </div>
        </div><!-- /main-content -->

        <!-- フッター -->
        <footer class="text-center text-sm text-gray-400 mt-8">
            <p>建設業安全教育サイトのSEO記事作成を支援するツールです</p>
        </footer>
    </div>

    <!-- v4: エクスポートモーダル -->
    <div id="export-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">エクスポート</h2>
                    <button type="button" onclick="closeExportModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>
                <p class="text-sm text-gray-600 mb-4">出力形式を選択してください</p>
                <div class="space-y-3">
                    <button onclick="exportExcel()" class="w-full p-4 border-2 border-indigo-200 rounded-xl hover:bg-indigo-50 text-left flex items-center gap-3">
                        <span class="material-symbols-outlined icon-xl text-indigo-600">table_chart</span>
                        <div>
                            <div class="font-semibold text-indigo-700">Excel形式 (.xlsx)</div>
                            <div class="text-xs text-gray-500">キーワード・クラスター・優先度をシート別に出力</div>
                        </div>
                    </button>
                    <button onclick="exportJSON()" class="w-full p-4 border-2 border-indigo-200 rounded-xl hover:bg-indigo-50 text-left flex items-center gap-3">
                        <span class="material-symbols-outlined icon-xl text-indigo-600">folder</span>
                        <div>
                            <div class="font-semibold text-indigo-700">JSON形式</div>
                            <div class="text-xs text-gray-500">完全なデータバックアップ（後でインポート可能）</div>
                        </div>
                    </button>
                    <button onclick="exportMarkdown()" class="w-full p-4 border-2 border-indigo-200 rounded-xl hover:bg-indigo-50 text-left flex items-center gap-3">
                        <span class="material-symbols-outlined icon-xl text-indigo-600">edit_note</span>
                        <div>
                            <div class="font-semibold text-indigo-700">マークダウン形式</div>
                            <div class="text-xs text-gray-500">記事構成案をMarkdown形式で出力</div>
                        </div>
                    </button>
                    <button onclick="exportCSV()" class="w-full p-4 border-2 border-gray-200 rounded-xl hover:bg-gray-50 text-left flex items-center gap-3">
                        <span class="material-symbols-outlined icon-xl text-slate-500">assignment</span>
                        <div>
                            <div class="font-semibold text-gray-700">CSV形式</div>
                            <div class="text-xs text-gray-500">シンプルなキーワード一覧</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- v4: インポートモーダル -->
    <div id="import-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">インポート</h2>
                    <button type="button" onclick="closeImportModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>
                <p class="text-sm text-gray-600 mb-4">以前にエクスポートしたJSONファイルを読み込みます</p>
                <div id="import-dropzone" class="w-full h-40 border-2 border-dashed border-indigo-300 rounded-xl flex flex-col items-center justify-center bg-indigo-50 hover:bg-blue-100 cursor-pointer transition-colors">
                    <svg class="w-12 h-12 text-blue-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                    <p class="text-indigo-700 font-medium">JSONファイルをドロップ、またはクリックして選択</p>
                    <input type="file" id="import-file-input" accept=".json" class="hidden">
                </div>
                <div class="mt-4 p-3 bg-slate-50 rounded-lg text-xs text-indigo-700">
                    <strong>注意:</strong> インポートすると現在のデータは上書きされます
                </div>
            </div>
        </div>
    </div>

    <!-- v4: クラスター編集モーダル -->
    <div id="cluster-edit-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">クラスター編集</h2>
                    <button type="button" onclick="closeClusterEditModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>
                <p class="text-sm text-gray-600 mb-4">キーワードをドラッグ＆ドロップでクラスター間を移動できます</p>
                <div class="mb-4 flex gap-2">
                    <button onclick="addCustomCluster()" class="bg-indigo-500 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm">+ 新規クラスター追加</button>
                </div>
                <div id="cluster-edit-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- 動的に生成 -->
                </div>
                <div class="mt-6 flex justify-end gap-3">
                    <button onclick="closeClusterEditModal()" class="px-6 py-2 border rounded-lg hover:bg-gray-50">キャンセル</button>
                    <button onclick="saveClusterEdits()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg">変更を保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AIプロンプトモーダル -->
    <div id="ai-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="ai-modal-title" class="text-xl font-bold">AIに送るプロンプト</h2>
                    <button type="button" onclick="closeAIModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>
                <p id="ai-modal-description" class="text-sm text-gray-600 mb-4">以下のプロンプトをコピーしてAIに貼り付けてください</p>
                <textarea id="ai-prompt" class="w-full h-64 p-4 border rounded-xl text-sm font-mono" readonly></textarea>
                <div class="flex gap-3 mt-4">
                    <button type="button" onclick="copyAIPrompt()" class="btn-primary text-white px-6 py-2 rounded-lg flex-1">プロンプトをコピー</button>
                    <a id="ai-link" href="https://claude.ai/" target="_blank" class="bg-gray-100 px-6 py-2 rounded-lg text-center hover:bg-gray-200">AIを開く</a>
                </div>
            </div>
        </div>
    </div>

    <script src="keyword-tool-v4-data.js"></script>
    <script src="keyword-tool-v4-app.js"></script>
    <script>
        // 外部JSファイルの読み込み確認
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                if (typeof loadSampleData !== 'function') {
                    console.error('外部JSファイルの読み込みに失敗しました');
                    alert('エラー: JavaScriptファイルを読み込めませんでした。\n\n' +
                          '【解決方法】\n' +
                          '1. keyword-tool-v4.html（単体版）をお使いください\n' +
                          '   → こちらは外部ファイル不要で動作します\n\n' +
                          '2. または、ローカルサーバーを起動してください\n' +
                          '   → ターミナルで以下を実行:\n' +
                          '   cd ' + location.pathname.replace(/[^/]+$/, '') + '\n' +
                          '   python -m http.server 8000\n' +
                          '   → ブラウザで http://localhost:8000 を開く');
                }
            }, 500);
        });
    </script>
</body>
</html>
