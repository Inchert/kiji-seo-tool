<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KCI教育センター SEOキーワード分析ツール v4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="keyword-tool-v4.css">
    <style>
        .material-symbols-outlined { font-size: 20px; vertical-align: middle; }
        .icon-sm { font-size: 16px; }
        .icon-lg { font-size: 24px; }
        .icon-xl { font-size: 32px; }

        /* ヘルプボタン・モーダル */
        .help-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            border: none;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s, box-shadow 0.2s;
            z-index: 40;
        }
        .help-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.5);
        }
        .help-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .help-modal.show { display: flex; }
        .help-content {
            background: white;
            border-radius: 16px;
            max-width: 700px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            padding: 30px;
        }
        .help-content h2 {
            color: #4f46e5;
            font-size: 22px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .help-content h3 {
            color: #1e293b;
            font-size: 16px;
            margin: 24px 0 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }
        .help-content h4 {
            color: #475569;
            font-size: 14px;
            margin: 16px 0 8px;
        }
        .help-content p, .help-content li {
            color: #64748b;
            font-size: 14px;
            line-height: 1.7;
        }
        .help-content ul { padding-left: 20px; margin: 8px 0; }
        .help-content .step-box {
            background: #f1f5f9;
            border-radius: 8px;
            padding: 12px 16px;
            margin: 12px 0;
        }
        .help-content .step-box strong { color: #4f46e5; }
        .help-close {
            float: right;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #94a3b8;
            line-height: 1;
        }
        .help-close:hover { color: #64748b; }

        /* SEO採点ツール */
        .seo-score-ring {
            position: relative;
            width: 120px;
            height: 120px;
        }
        .seo-score-ring svg { transform: rotate(-90deg); }
        .seo-score-ring circle { fill: none; stroke-width: 10; }
        .seo-score-ring .bg { stroke: #e2e8f0; }
        .seo-score-ring .progress { stroke-linecap: round; transition: stroke-dashoffset 0.8s ease-out; }
        .seo-score-value { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 28px; font-weight: bold; }
        .score-item { display: flex; align-items: center; justify-content: space-between; padding: 8px 12px; border-radius: 8px; margin-bottom: 6px; }
        .score-item.good { background: #dcfce7; }
        .score-item.warning { background: #fef3c7; }
        .score-item.bad { background: #fee2e2; }
        .score-bar { width: 60px; height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden; }
        .score-bar-fill { height: 100%; border-radius: 3px; transition: width 0.5s ease-out; }
        .score-bar-fill.good { background: #22c55e; }
        .score-bar-fill.warning { background: #f59e0b; }
        .score-bar-fill.bad { background: #ef4444; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-indigo-50 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-6xl">

        <!-- ヘッダー -->
        <header class="text-center mb-8">
            <div class="flex justify-between items-center mb-4">
                <a href="index.html" class="flex items-center gap-1 text-sm text-gray-500 hover:text-indigo-600 transition-colors">
                    <span class="material-symbols-outlined" style="font-size: 18px;">logout</span>
                    ログアウト
                </a>
                <a href="competitor-strategy.html" class="flex items-center gap-1 text-sm text-indigo-600 hover:text-indigo-800 bg-indigo-50 hover:bg-indigo-100 px-3 py-1 rounded-full transition-colors">
                    <span class="material-symbols-outlined" style="font-size: 18px;">strategy</span>
                    競合対策ツール
                </a>
            </div>
            <h1 class="text-3xl font-bold text-gray-800 mb-2"><span class="text-indigo-600">KCI教育センター</span> SEOキーワード分析ツール <span class="text-sm bg-indigo-500 text-white px-2 py-1 rounded-full ml-2">v4</span></h1>
            <p class="text-gray-600">キーワード分析から記事構成・競合比較まで、SEO記事作成をワンストップで支援</p>
            <p class="text-xs text-gray-400 mt-1">kensetsu-mikata.jp 専用 | Excel出力・クラスター編集・競合ヒートマップ・データ保存/復元対応</p>
        </header>

        <!-- ステップインジケーター -->
        <div class="flex justify-center gap-2 mb-8 flex-wrap">
            <div id="step-indicator-1" class="flex items-center gap-2 px-4 py-2 rounded-full bg-indigo-600 text-white text-sm font-medium">
                <span class="w-6 h-6 rounded-full bg-white text-indigo-600 flex items-center justify-center text-xs font-bold">1</span>
                データ入力
            </div>
            <div class="flex items-center text-gray-300">→</div>
            <div id="step-indicator-2" class="flex items-center gap-2 px-4 py-2 rounded-full bg-gray-200 text-gray-500 text-sm font-medium">
                <span class="w-6 h-6 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-xs font-bold">2</span>
                分析結果
            </div>
            <div class="flex items-center text-gray-300">→</div>
            <div id="step-indicator-3" class="flex items-center gap-2 px-4 py-2 rounded-full bg-gray-200 text-gray-500 text-sm font-medium">
                <span class="w-6 h-6 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-xs font-bold">3</span>
                記事設計
            </div>
        </div>

        <!-- メインコンテンツ -->
        <div id="main-content">

            <!-- STEP 1: データ入力 -->
            <div id="step-1" class="fade-in">
                <div class="glass-card rounded-2xl shadow-xl p-8 mb-6">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 rounded-full bg-indigo-600 text-white flex items-center justify-center font-bold">1</div>
                        <div>
                            <h2 class="text-xl font-bold text-gray-800">キーワードデータを入力</h2>
                            <p class="text-sm text-gray-500">ラッコキーワード → キーワードプランナー → CSV取り込み</p>
                        </div>
                    </div>

                    <!-- ビッグキーワード候補（STEP 0） -->
                    <div class="bg-gradient-to-r from-slate-50 to-indigo-50 border-2 border-indigo-200 rounded-xl p-5 mb-6">
                        <h3 class="font-bold text-indigo-800 mb-3 flex items-center gap-2">
                            <span class="material-symbols-outlined icon-lg">target</span>
                            STEP 0：検索すべきビッグキーワードを確認
                        </h3>
                        <p class="text-xs text-indigo-700 mb-4">教育テーマを選ぶと、ラッコキーワードで検索すべきキーワードバリエーションが表示されます。全てのバリエーションで検索すると、関連キーワードを漏れなく取得できます。</p>

                        <!-- テーマ選択 -->
                        <div class="mb-4">
                            <label class="block text-sm font-semibold text-indigo-800 mb-2">教育テーマを選択</label>
                            <select id="big-keyword-theme" onchange="showBigKeywordVariations()" class="w-full p-3 border-2 border-indigo-200 rounded-lg bg-white text-sm">
                                <option value="">-- テーマを選んでください --</option>
                                <optgroup label="優先度：高（検索ボリューム大）">
                                    <option value="職長">職長・安全衛生責任者教育</option>
                                    <option value="フルハーネス">フルハーネス型墜落制止用器具特別教育</option>
                                    <option value="足場">足場の組立て等特別教育</option>
                                    <option value="玉掛け">玉掛け技能講習</option>
                                    <option value="フォークリフト">フォークリフト運転技能講習</option>
                                </optgroup>
                                <optgroup label="優先度：中">
                                    <option value="酸欠">酸素欠乏・硫化水素危険作業特別教育</option>
                                    <option value="低圧電気">低圧電気取扱特別教育</option>
                                    <option value="粉じん">粉じん作業特別教育</option>
                                    <option value="石綿">石綿取扱い作業従事者特別教育</option>
                                    <option value="高所作業車">高所作業車運転特別教育</option>
                                    <option value="クレーン">クレーン運転特別教育</option>
                                    <option value="アーク溶接">アーク溶接等作業特別教育</option>
                                    <option value="小型車両系">小型車両系建設機械運転特別教育</option>
                                </optgroup>
                                <optgroup label="優先度：低">
                                    <option value="丸のこ">丸のこ等取扱作業従事者教育</option>
                                    <option value="研削砥石">研削砥石取替試運転業務特別教育</option>
                                    <option value="刈払機">刈払機取扱作業者安全衛生教育</option>
                                    <option value="振動工具">振動工具取扱作業者安全衛生教育</option>
                                    <option value="ロープ高所">ロープ高所作業特別教育</option>
                                    <option value="ゴンドラ">ゴンドラ取扱特別教育</option>
                                    <option value="巻上げ機">巻上げ機運転特別教育</option>
                                </optgroup>
                            </select>
                        </div>

                        <!-- ボリュームフィルター -->
                        <div class="mb-4 p-3 bg-white rounded-lg border border-indigo-200">
                            <label class="block text-sm font-semibold text-indigo-800 mb-2">
                                <span class="material-symbols-outlined icon-sm" style="vertical-align: middle;">filter_alt</span>
                                ボリュームで絞り込み
                            </label>
                            <div class="flex items-center gap-2">
                                <input type="number" id="volume-filter-min" placeholder="最小" min="0" step="100"
                                    class="w-24 p-2 border border-gray-300 rounded text-sm" onchange="showBigKeywordVariations()">
                                <span class="text-gray-500">〜</span>
                                <input type="number" id="volume-filter-max" placeholder="最大" min="0" step="100"
                                    class="w-24 p-2 border border-gray-300 rounded text-sm" onchange="showBigKeywordVariations()">
                                <span class="text-xs text-gray-500">/月</span>
                                <button type="button" onclick="clearVolumeFilter()" class="text-xs text-indigo-500 hover:text-indigo-700 underline ml-2">クリア</button>
                                <span id="volume-filter-info" class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded hidden ml-auto"></span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">例：500〜2000で中規模キーワードを抽出</p>
                        </div>

                        <!-- キーワードバリエーション表示エリア -->
                        <div id="big-keyword-variations" class="hidden">
                            <div class="bg-white rounded-lg p-4 border border-indigo-200">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 id="big-keyword-theme-name" class="font-bold text-gray-800"></h4>
                                    <span id="big-keyword-total-volume" class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded-full"></span>
                                </div>
                                <p class="text-xs text-gray-500 mb-3">以下のキーワードを全てラッコキーワードで検索してください：</p>
                                <div id="big-keyword-list" class="space-y-2"></div>
                                <div class="mt-4 pt-4 border-t border-gray-200 flex gap-2">
                                    <button type="button" onclick="copyBigKeywords()" class="flex-1 bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-semibold">
                                        全キーワードをコピー
                                    </button>
                                    <a href="https://related-keywords.com/" target="_blank" class="flex-1 bg-indigo-600 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-semibold text-center">
                                        ラッコキーワードを開く
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- フローガイド -->
                    <div class="bg-gradient-to-r from-indigo-50 to-slate-50 border border-indigo-200 rounded-xl p-5 mb-6">
                        <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                            <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                            推奨フロー（実ボリューム取得）
                        </h3>
                        <div class="grid md:grid-cols-3 gap-4">
                            <!-- STEP 1 -->
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="w-6 h-6 rounded-full bg-indigo-600 text-white text-xs flex items-center justify-center font-bold">1</span>
                                    <span class="font-semibold text-indigo-800">サジェスト取得</span>
                                </div>
                                <ol class="text-xs text-gray-600 space-y-1 ml-8">
                                    <li>• <a href="https://related-keywords.com/" target="_blank" class="text-indigo-600 underline">ラッコキーワード</a>で検索</li>
                                    <li>• 「全キーワードコピー」</li>
                                </ol>
                            </div>
                            <!-- STEP 2 -->
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="w-6 h-6 rounded-full bg-indigo-500 text-white text-xs flex items-center justify-center font-bold">2</span>
                                    <span class="font-semibold text-indigo-700">ボリューム取得</span>
                                </div>
                                <ol class="text-xs text-gray-600 space-y-1 ml-8">
                                    <li>• <a href="https://ads.google.com/aw/keywordplanner/home" target="_blank" class="text-indigo-500 underline">キーワードプランナー</a>を開く</li>
                                    <li>• 「検索ボリュームと予測」に貼り付け</li>
                                    <li>• 右上「ダウンロード」→「過去のプラン指標」→「.csv」</li>
                                </ol>
                            </div>
                            <!-- STEP 3 -->
                            <div class="bg-white rounded-lg p-4 shadow-sm">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="w-6 h-6 rounded-full bg-indigo-600 text-white text-xs flex items-center justify-center font-bold">3</span>
                                    <span class="font-semibold text-indigo-800">CSV取り込み</span>
                                </div>
                                <ol class="text-xs text-gray-600 space-y-1 ml-8">
                                    <li>• 下のエリアにCSVをドロップ</li>
                                    <li>• 「分析開始」をクリック</li>
                                </ol>
                            </div>
                        </div>
                    </div>

                    <!-- CSVファイル選択エリア -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">キーワードプランナーCSVファイル</label>
                        <div id="csv-dropzone" class="w-full h-40 border-2 border-dashed border-indigo-300 rounded-xl flex flex-col items-center justify-center bg-indigo-50 hover:bg-indigo-100 cursor-pointer transition-colors">
                            <svg class="w-12 h-12 text-indigo-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path></svg>
                            <p class="text-indigo-700 font-medium">CSVファイルをドロップ、またはクリックして選択</p>
                            <p class="text-indigo-500 text-xs mt-1">キーワードプランナーからダウンロードした「過去のプラン指標.csv」</p>
                            <input type="file" id="csv-file-input" accept=".csv" class="hidden">
                        </div>
                        <div id="csv-file-info" class="hidden mt-4 p-4 bg-indigo-100 rounded-xl">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <svg class="w-8 h-8 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                    <div>
                                        <p id="csv-filename" class="font-medium text-indigo-700">ファイル名</p>
                                        <p id="csv-rowcount" class="text-sm text-indigo-500">0行</p>
                                    </div>
                                </div>
                                <button type="button" onclick="clearCSVFile()" class="text-slate-500 hover:text-slate-700">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- または簡易モード -->
                    <div class="border-t border-gray-200 pt-6 mt-6">
                        <details class="group">
                            <summary class="cursor-pointer text-sm text-gray-500 hover:text-gray-700 flex items-center gap-2">
                                <svg class="w-4 h-4 transition-transform group-open:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                CSVがない場合（推定ボリュームで分析）
                            </summary>
                            <div class="mt-4">
                                <textarea id="keyword-input" class="w-full h-48 p-4 border-2 border-gray-200 rounded-xl text-sm focus:border-indigo-500 resize-none" placeholder="ラッコキーワードからコピーしたキーワードを貼り付け（1行に1キーワード）

例：
職長教育
職長教育 オンライン
職長教育 費用
..."></textarea>
                                <p class="text-xs text-gray-500 mt-2">※ボリュームは推定値が自動で割り当てられます（精度は低め）</p>
                            </div>
                        </details>
                    </div>

                    <!-- 分析ボタン -->
                    <div class="flex flex-col sm:flex-row gap-4 justify-between items-center mt-6">
                        <button type="button" onclick="loadSampleData()" class="text-sm text-gray-500 hover:text-indigo-600 underline cursor-pointer">サンプルデータで試す</button>
                        <button type="button" onclick="startAnalysis()" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold shadow-lg flex items-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                            分析開始
                        </button>
                    </div>
                </div>
            </div>

            <!-- STEP 2: 分析結果 -->
            <div id="step-2" class="hidden fade-in">
                <div class="glass-card rounded-2xl shadow-xl p-8 mb-6">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-indigo-500 text-white flex items-center justify-center font-bold">2</div>
                            <div>
                                <h2 class="text-xl font-bold text-gray-800">分析結果</h2>
                                <p class="text-sm text-gray-500">キーワードが自動でグループ分けされました</p>
                            </div>
                        </div>
                        <button type="button" onclick="goToStep(1)" class="text-sm text-gray-500 hover:text-indigo-600 flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            戻る
                        </button>
                    </div>

                    <!-- サマリー -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                        <div class="bg-gradient-to-br from-indigo-600 to-indigo-700 rounded-xl p-4 text-white text-center shadow-lg">
                            <div class="text-3xl font-bold" id="summary-keywords">0</div>
                            <div class="text-sm opacity-90">キーワード数</div>
                        </div>
                        <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-xl p-4 text-white text-center shadow-md">
                            <div class="text-3xl font-bold" id="summary-clusters">0</div>
                            <div class="text-sm opacity-90">グループ数</div>
                        </div>
                        <div class="bg-gradient-to-br from-indigo-400 to-indigo-500 rounded-xl p-4 text-white text-center shadow-md">
                            <div class="text-3xl font-bold" id="summary-articles">0</div>
                            <div class="text-sm opacity-90">推奨記事数</div>
                        </div>
                        <div class="bg-gradient-to-br from-slate-500 to-slate-600 rounded-xl p-4 text-white text-center shadow-md">
                            <div class="text-3xl font-bold" id="summary-priority">0</div>
                            <div class="text-sm opacity-90">高優先グループ</div>
                        </div>
                    </div>

                    <!-- グループ一覧 -->
                    <h3 class="font-bold text-gray-700 mb-4">グループ一覧 <span class="text-sm font-normal text-gray-500">（クリックで記事設計へ）</span></h3>
                    <div id="cluster-list" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                        <!-- 動的に生成 -->
                    </div>

                    <!-- 優先度TOP20 -->
                    <h3 class="font-bold text-gray-700 mb-4">優先度TOP20キーワード</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="p-3 text-left rounded-tl-lg">順位</th>
                                    <th class="p-3 text-left">キーワード</th>
                                    <th class="p-3 text-center">推定Vol</th>
                                    <th class="p-3 text-center">検索意図</th>
                                    <th class="p-3 text-center">CV期待</th>
                                    <th class="p-3 text-center rounded-tr-lg">一次情報</th>
                                </tr>
                            </thead>
                            <tbody id="priority-table">
                                <!-- 動的に生成 -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- エクスポートボタン（v4拡張） -->
                <div class="flex flex-wrap justify-center gap-3 mb-6">
                    <button type="button" onclick="openExportModal()" class="bg-indigo-500 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg text-sm flex items-center gap-2 font-medium">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        エクスポート
                    </button>
                    <button type="button" onclick="openImportModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg text-sm flex items-center gap-2 font-medium">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                        インポート
                    </button>
                    <button type="button" onclick="exportCSV()" class="bg-white border border-gray-300 px-6 py-2 rounded-lg text-sm hover:bg-gray-50 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        CSV出力
                    </button>
                    <button type="button" onclick="saveData()" class="bg-white border border-gray-300 px-6 py-2 rounded-lg text-sm hover:bg-gray-50 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                        保存
                    </button>
                    <button type="button" onclick="openClusterEditModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg text-sm flex items-center gap-2 font-medium">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                        クラスター編集
                    </button>
                </div>
            </div>

            <!-- STEP 3: 記事設計（競合分析タブ含む） -->
            <div id="step-3" class="hidden fade-in">
                <div class="glass-card rounded-2xl shadow-xl p-8 mb-6">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-indigo-600 text-white flex items-center justify-center font-bold">3</div>
                            <div>
                                <h2 class="text-xl font-bold text-gray-800">記事設計</h2>
                                <p class="text-sm text-gray-500" id="selected-cluster-name">グループを選択してください</p>
                            </div>
                        </div>
                        <button type="button" onclick="goToStep(2)" class="text-sm text-gray-500 hover:text-indigo-600 flex items-center gap-1">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                            結果に戻る
                        </button>
                    </div>

                    <!-- メインタブナビゲーション -->
                    <div class="flex gap-2 mb-6 border-b border-gray-200">
                        <button type="button" onclick="showArticleMainTab('design')" class="article-main-tab-btn px-6 py-3 rounded-t-lg text-sm font-semibold bg-indigo-100 text-indigo-700 border-b-2 border-indigo-600" data-tab="design">
                            <span class="material-symbols-outlined icon-sm">edit_note</span> 構成作成
                        </button>
                        <button type="button" onclick="showArticleMainTab('competitor')" class="article-main-tab-btn px-6 py-3 rounded-t-lg text-sm font-semibold bg-gray-100 text-gray-600 border-b-2 border-transparent hover:bg-gray-200" data-tab="competitor">
                            <span class="material-symbols-outlined icon-sm">target</span> 競合分析（任意）
                        </button>
                    </div>

                    <!-- タブコンテンツ: 構成作成 -->
                    <div id="article-main-tab-design" class="article-main-tab-content">

                    <!-- 記事タイプ選択 -->
                    <div class="mb-6">
                        <label class="block font-semibold text-gray-700 mb-3">記事タイプを選択</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3">
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="pillar" checked class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">menu_book</span> ピラー記事</div>
                                    <div class="text-xs text-gray-500 mt-1">総合ガイド・完全解説</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: SEO基盤構築、内部リンクのハブ</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="howto" class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">list_alt</span> ハウツー</div>
                                    <div class="text-xs text-gray-500 mt-1">手順解説・申込み方法</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: 申込導線に直結、CV率高</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="comparison" class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">trophy</span> 選び方ガイド</div>
                                    <div class="text-xs text-gray-500 mt-1">講座紹介・自社推し</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: 比較検討層を獲得、差別化</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="faq" class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">help</span> FAQ形式</div>
                                    <div class="text-xs text-gray-500 mt-1">Q&A・よくある質問</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: 強調スニペット獲得、音声検索対応</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="case" class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">work</span> 事例・体験談</div>
                                    <div class="text-xs text-gray-500 mt-1">受講者の声・活用事例</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: 信頼性UP、E-E-A-T強化</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="glossary" class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">dictionary</span> 用語解説</div>
                                    <div class="text-xs text-gray-500 mt-1">〇〇とは・基礎知識</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: 検索流入増、初心者獲得</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="checklist" class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">checklist</span> チェックリスト</div>
                                    <div class="text-xs text-gray-500 mt-1">準備・持ち物・確認事項</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: 実用性高、ブックマーク獲得</div>
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="article-type" value="news" class="hidden peer">
                                <div class="p-3 border-2 rounded-xl peer-checked:border-indigo-500 peer-checked:bg-indigo-50 hover:bg-gray-50 h-full">
                                    <div class="font-semibold text-sm text-indigo-700"><span class="material-symbols-outlined icon-sm">newspaper</span> 法改正・ニュース</div>
                                    <div class="text-xs text-gray-500 mt-1">最新情報・制度変更</div>
                                    <div class="text-xs text-indigo-500 mt-2 font-medium">効果: 専門性アピール、リピーター獲得</div>
                                </div>
                            </label>
                        </div>
                        <!-- 記事タイプ効果サマリー -->
                        <div class="mt-4 p-3 bg-slate-50 border border-indigo-200 rounded-lg text-xs text-indigo-800">
                            <strong><span class="material-symbols-outlined icon-sm">lightbulb</span> 選び方のコツ：</strong>
                            CV重視なら「ハウツー」「選び方ガイド」、SEO基盤なら「ピラー記事」「用語解説」、信頼性なら「事例」「法改正」がおすすめ
                        </div>
                    </div>

                    <div class="mb-6">
                        <a href="javascript:void(0)" id="generate-article-btn" onclick="generateArticleDesign(); return false;" class="btn-success text-white px-6 py-3 rounded-xl font-semibold w-full block text-center cursor-pointer" style="display: block;">
                            記事構成を生成
                        </a>
                    </div>

                    <!-- 生成結果 -->
                    <div id="article-design-result" class="hidden">
                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- 左カラム：構成案 -->
                            <div>
                                <h3 class="font-bold text-gray-700 mb-3 flex items-center gap-2">
                                    <svg class="w-5 h-5 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                    記事構成案
                                </h3>
                                <!-- 構成表示切替タブ -->
                                <div class="flex gap-2 mb-3">
                                    <button type="button" onclick="showOutlineTab('basic')" class="outline-tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-100 text-gray-600" data-tab="basic">
                                        <span class="material-symbols-outlined icon-sm">description</span> 基本構成
                                    </button>
                                    <button type="button" onclick="showOutlineTab('integrated')" class="outline-tab-btn px-4 py-2 rounded-lg text-sm font-medium bg-indigo-100 text-indigo-700" data-tab="integrated">
                                        <span class="material-symbols-outlined icon-sm">auto_awesome</span> SEO統合版
                                    </button>
                                </div>
                                <!-- 基本構成 -->
                                <div id="article-outline-basic" class="outline-tab-content hidden">
                                    <div id="article-outline" class="bg-gray-50 rounded-xl p-4 text-sm whitespace-pre-wrap font-mono"></div>
                                </div>
                                <!-- SEO統合版 -->
                                <div id="article-outline-integrated-container" class="outline-tab-content">
                                    <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-3 mb-3 text-sm text-indigo-800">
                                        <span class="material-symbols-outlined icon-sm">info</span>
                                        <strong>SEO統合版</strong>：CTA・内部リンク・E-E-A-T要素が記事構成に直接組み込まれています。このままWordPressに貼り付けるとプレビューできます。
                                    </div>
                                    <div id="article-outline-integrated" class="bg-white rounded-xl p-4 text-sm border border-gray-200 overflow-auto max-h-[600px]"></div>
                                </div>
                            </div>

                            <!-- 右カラム：タイトル・メタ -->
                            <div class="space-y-4">
                                <div>
                                    <h3 class="font-bold text-gray-700 mb-3">SEOタイトル案</h3>
                                    <div id="title-suggestions" class="space-y-2"></div>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-700 mb-3">メタディスクリプション</h3>
                                    <div id="meta-description" class="bg-gray-50 rounded-xl p-4 text-sm"></div>
                                </div>
                                <div>
                                    <h3 class="font-bold text-gray-700 mb-3">参照すべき一次情報</h3>
                                    <div id="primary-sources" class="space-y-2"></div>
                                </div>
                            </div>
                        </div>

                        <!-- ===== アクションボタン（最上部に配置）===== -->
                        <div class="mt-6 bg-white rounded-xl border-2 border-indigo-200 p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="font-bold text-gray-800 flex items-center gap-2">
                                    <span class="material-symbols-outlined text-indigo-600">rocket_launch</span>
                                    次のステップ
                                </h3>
                                <div class="flex items-center gap-1 text-xs text-gray-500">
                                    <span>AI:</span>
                                    <select id="ai-select-compact" class="border rounded px-2 py-1 text-xs" onchange="syncAISelect(this.value)">
                                        <option value="claude" selected>Claude</option>
                                        <option value="chatgpt">ChatGPT</option>
                                        <option value="gemini">Gemini</option>
                                    </select>
                                </div>
                            </div>
                            <div class="grid grid-cols-3 gap-2">
                                <button type="button" onclick="copyForAI()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-3 rounded-lg font-medium text-sm flex items-center justify-center gap-1">
                                    <span class="material-symbols-outlined icon-sm">edit_note</span>
                                    AIで本文作成
                                </button>
                                <button type="button" onclick="copyOutline()" class="bg-white border-2 border-indigo-300 hover:bg-indigo-50 text-indigo-700 px-4 py-3 rounded-lg font-medium text-sm flex items-center justify-center gap-1">
                                    <span class="material-symbols-outlined icon-sm">content_copy</span>
                                    構成をコピー
                                </button>
                                <button type="button" onclick="copyEvaluationPrompt()" class="bg-white border-2 border-orange-300 hover:bg-orange-50 text-orange-700 px-4 py-3 rounded-lg font-medium text-sm flex items-center justify-center gap-1">
                                    <span class="material-symbols-outlined icon-sm">fact_check</span>
                                    記事を採点
                                </button>
                            </div>
                        </div>

                        <!-- ===== SEO採点（コンパクト表示）===== -->
                        <div class="mt-4 bg-gradient-to-r from-slate-50 to-gray-50 rounded-xl border p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    <h3 class="font-semibold text-gray-700 flex items-center gap-2">
                                        <span class="material-symbols-outlined text-emerald-600">speed</span>
                                        SEOスコア
                                    </h3>
                                    <div class="flex items-center gap-3">
                                        <div class="flex items-center gap-1.5 bg-blue-50 px-3 py-1.5 rounded-full border border-blue-200">
                                            <span class="text-xs text-blue-600">記事</span>
                                            <span id="article-score-compact" class="font-bold text-blue-700">--</span>
                                            <span class="text-xs text-blue-500">/55</span>
                                        </div>
                                        <div class="flex items-center gap-1.5 bg-emerald-50 px-3 py-1.5 rounded-full border border-emerald-200">
                                            <span class="text-xs text-emerald-600">総合</span>
                                            <span id="total-score-compact" class="font-bold text-emerald-700">--</span>
                                            <span class="text-xs text-emerald-500">/100</span>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" onclick="toggleScoreDetail()" class="text-gray-500 hover:text-gray-700 text-sm flex items-center gap-1">
                                    <span id="score-toggle-text">詳細</span>
                                    <span class="material-symbols-outlined icon-sm" id="score-toggle-icon">expand_more</span>
                                </button>
                            </div>

                            <!-- 詳細スコア（折りたたみ） -->
                            <div id="score-detail-section" class="hidden mt-4 pt-4 border-t">
                                <div id="seo-score-result">
                                    <div class="grid md:grid-cols-2 gap-3 mb-3">
                                        <!-- 記事品質スコア -->
                                        <div class="bg-white rounded-lg p-3 border">
                                            <div class="flex items-center gap-3">
                                                <div class="seo-score-ring" style="width: 60px; height: 60px;">
                                                    <svg width="60" height="60">
                                                        <circle class="bg" cx="30" cy="30" r="24" stroke-width="6"/>
                                                        <circle class="progress" id="article-score-ring" cx="30" cy="30" r="24" stroke="#3b82f6" stroke-width="6" stroke-dasharray="151" stroke-dashoffset="151"/>
                                                    </svg>
                                                    <div class="seo-score-value" id="article-score-value" style="font-size: 14px;">--</div>
                                                </div>
                                                <div>
                                                    <div class="text-xs text-gray-500">記事品質</div>
                                                    <div id="article-score-grade" class="font-bold text-blue-700">--</div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- 総合SEOスコア -->
                                        <div class="bg-white rounded-lg p-3 border">
                                            <div class="flex items-center gap-3">
                                                <div class="seo-score-ring" style="width: 60px; height: 60px;">
                                                    <svg width="60" height="60">
                                                        <circle class="bg" cx="30" cy="30" r="24" stroke-width="6"/>
                                                        <circle class="progress" id="score-ring-progress" cx="30" cy="30" r="24" stroke="#22c55e" stroke-width="6" stroke-dasharray="151" stroke-dashoffset="151"/>
                                                    </svg>
                                                    <div class="seo-score-value" id="total-score-value" style="font-size: 14px;">--</div>
                                                </div>
                                                <div>
                                                    <div class="text-xs text-gray-500">総合SEO</div>
                                                    <div id="score-grade" class="font-bold text-emerald-700">--</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- 項目別（2行で表示） -->
                                    <div id="score-items" class="grid grid-cols-3 md:grid-cols-6 gap-2 text-center text-xs">
                                        <div class="score-item-mini bg-white rounded p-2 border"><div class="text-gray-500">タイトル</div><div class="font-bold">--</div></div>
                                        <div class="score-item-mini bg-white rounded p-2 border"><div class="text-gray-500">メタ</div><div class="font-bold">--</div></div>
                                        <div class="score-item-mini bg-white rounded p-2 border"><div class="text-gray-500">見出し</div><div class="font-bold">--</div></div>
                                        <div class="score-item-mini bg-white rounded p-2 border"><div class="text-gray-500">E-E-A-T</div><div class="font-bold">--</div></div>
                                        <div class="score-item-mini bg-white rounded p-2 border"><div class="text-gray-500">CTA</div><div class="font-bold">--</div></div>
                                        <div class="score-item-mini bg-white rounded p-2 border"><div class="text-gray-500">差別化</div><div class="font-bold">--</div></div>
                                    </div>
                                    <!-- 改善提案 -->
                                    <div class="mt-3 bg-amber-50 rounded-lg p-3 border border-amber-200">
                                        <div class="font-semibold text-amber-800 text-sm mb-2 flex items-center gap-1">
                                            <span class="material-symbols-outlined icon-sm">lightbulb</span>改善提案
                                        </div>
                                        <ul id="score-suggestions" class="text-xs text-amber-700 space-y-1"><li>構成を生成すると採点されます</li></ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ===== プロ向けSEO戦略（折りたたみ）===== -->
                        <details class="mt-4">
                            <summary class="cursor-pointer bg-slate-100 hover:bg-slate-200 rounded-xl p-3 flex items-center justify-between transition-colors">
                                <span class="font-semibold text-gray-700 flex items-center gap-2">
                                    <span class="material-symbols-outlined icon-sm text-indigo-600">psychology</span>
                                    プロ向けSEO戦略
                                </span>
                                <span class="text-xs text-gray-500">E-E-A-T / CTA / 内部リンク / 構造化データ / AI差別化</span>
                            </summary>
                            <div class="mt-2 bg-white rounded-xl border p-4">
                                <!-- タブナビゲーション -->
                                <div class="flex flex-wrap gap-1 mb-3">
                                    <button type="button" onclick="showProTab('eeat')" class="pro-tab-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-indigo-100 text-indigo-700" data-tab="eeat">E-E-A-T</button>
                                    <button type="button" onclick="showProTab('cta')" class="pro-tab-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-100 text-gray-600" data-tab="cta">CTA</button>
                                    <button type="button" onclick="showProTab('links')" class="pro-tab-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-100 text-gray-600" data-tab="links">内部リンク</button>
                                    <button type="button" onclick="showProTab('schema')" class="pro-tab-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-100 text-gray-600" data-tab="schema">構造化</button>
                                    <button type="button" onclick="showProTab('diff')" class="pro-tab-btn px-3 py-1.5 rounded-lg text-xs font-medium bg-gray-100 text-gray-600" data-tab="diff">差別化</button>
                                </div>
                                <!-- タブコンテンツ -->
                                <div id="pro-tab-eeat" class="pro-tab-content bg-indigo-50 rounded-lg p-3">
                                    <pre id="pro-tips-eeat" class="text-xs whitespace-pre-wrap font-mono text-indigo-900"></pre>
                                </div>
                                <div id="pro-tab-cta" class="pro-tab-content hidden bg-slate-50 rounded-lg p-3">
                                    <pre id="pro-tips-cta" class="text-xs whitespace-pre-wrap font-mono text-slate-900"></pre>
                                </div>
                                <div id="pro-tab-links" class="pro-tab-content hidden bg-blue-50 rounded-lg p-3">
                                    <pre id="pro-tips-links" class="text-xs whitespace-pre-wrap font-mono text-blue-900"></pre>
                                </div>
                                <div id="pro-tab-schema" class="pro-tab-content hidden bg-slate-50 rounded-lg p-3">
                                    <pre id="pro-tips-schema" class="text-xs whitespace-pre-wrap font-mono text-slate-800"></pre>
                                </div>
                                <div id="pro-tab-diff" class="pro-tab-content hidden bg-slate-50 rounded-lg p-3">
                                    <pre id="pro-tips-diff" class="text-xs whitespace-pre-wrap font-mono text-slate-800"></pre>
                                </div>
                            </div>
                        </details>
                    </div>
                    </div><!-- /article-main-tab-design -->

                    <!-- タブコンテンツ: 競合分析 -->
                    <div id="article-main-tab-competitor" class="article-main-tab-content hidden">
                        <!-- 使い方ガイド -->
                        <div class="bg-gradient-to-r from-slate-50 to-indigo-50 border border-slate-300 rounded-xl p-4 mb-6">
                            <h3 class="font-semibold text-slate-700 mb-3 flex items-center gap-2">
                                <span class="material-symbols-outlined icon-sm">target</span> 検索1位を取るための競合分析（任意）
                            </h3>
                            <p class="text-xs text-gray-600 mb-3">競合の見出しを分析して、より良い記事構成を作成できます。スキップして構成作成タブに進むことも可能です。</p>
                            <div class="grid md:grid-cols-4 gap-3 text-sm">
                                <div class="bg-white rounded-lg p-3">
                                    <div class="font-bold text-slate-700 mb-1">① 検索</div>
                                    <div class="text-gray-600 text-xs">対象キーワードでGoogle検索</div>
                                </div>
                                <div class="bg-white rounded-lg p-3">
                                    <div class="font-bold text-slate-700 mb-1">② 見出し取得</div>
                                    <div class="text-gray-600 text-xs">上位3サイトを開いてH2/H3をコピー</div>
                                </div>
                                <div class="bg-white rounded-lg p-3">
                                    <div class="font-bold text-slate-700 mb-1">③ 貼り付け</div>
                                    <div class="text-gray-600 text-xs">下のエリアに見出しを貼り付け</div>
                                </div>
                                <div class="bg-white rounded-lg p-3">
                                    <div class="font-bold text-slate-700 mb-1">④ 分析</div>
                                    <div class="text-gray-600 text-xs">必須見出し・差別化ポイントを抽出</div>
                                </div>
                            </div>
                            <p class="text-xs text-slate-600 mt-3"><span class="material-symbols-outlined icon-sm">lightbulb</span> 見出しの取得方法：記事ページで右クリック→「検証」→見出しタグ（h2, h3）をコピー、または目次があればそれをコピー</p>
                        </div>

                        <!-- 競合サイト見出し入力（3サイト分） -->
                        <div class="space-y-4 mb-6">
                            <!-- 競合サイト1 -->
                            <div class="border-2 border-indigo-300 rounded-xl p-4 bg-indigo-50">
                                <div class="flex items-center gap-2 mb-3">
                                    <span class="w-8 h-8 rounded-full bg-indigo-500 text-white flex items-center justify-center font-bold">1</span>
                                    <span class="font-bold text-indigo-800">1位サイト</span>
                                    <input type="text" id="comp-1-title" class="flex-1 p-2 border rounded-lg text-sm" placeholder="サイト名/タイトル（任意）">
                                </div>
                                <textarea id="comp-1-headings" class="w-full h-32 p-3 border-2 border-indigo-200 rounded-xl text-sm resize-none" placeholder="見出しを貼り付け（1行1見出し）

例：
職長教育とは
職長教育の受講対象者
職長教育のカリキュラム
受講方法と費用
オンラインで受講する方法
よくある質問"></textarea>
                            </div>

                            <!-- 競合サイト2 -->
                            <div class="border-2 border-gray-200 rounded-xl p-4">
                                <div class="flex items-center gap-2 mb-3">
                                    <span class="w-8 h-8 rounded-full bg-gray-400 text-white flex items-center justify-center font-bold">2</span>
                                    <span class="font-bold text-gray-700">2位サイト</span>
                                    <input type="text" id="comp-2-title" class="flex-1 p-2 border rounded-lg text-sm" placeholder="サイト名/タイトル（任意）">
                                </div>
                                <textarea id="comp-2-headings" class="w-full h-32 p-3 border-2 border-gray-200 rounded-xl text-sm resize-none" placeholder="見出しを貼り付け（1行1見出し）"></textarea>
                            </div>

                            <!-- 競合サイト3 -->
                            <div class="border-2 border-gray-200 rounded-xl p-4">
                                <div class="flex items-center gap-2 mb-3">
                                    <span class="w-8 h-8 rounded-full bg-gray-400 text-white flex items-center justify-center font-bold">3</span>
                                    <span class="font-bold text-gray-700">3位サイト</span>
                                    <input type="text" id="comp-3-title" class="flex-1 p-2 border rounded-lg text-sm" placeholder="サイト名/タイトル（任意）">
                                </div>
                                <textarea id="comp-3-headings" class="w-full h-32 p-3 border-2 border-gray-200 rounded-xl text-sm resize-none" placeholder="見出しを貼り付け（1行1見出し）"></textarea>
                            </div>
                        </div>

                        <!-- 分析実行ボタン -->
                        <button type="button" onclick="analyzeCompetitorHeadings()" class="w-full bg-indigo-700 hover:bg-indigo-800 text-white px-6 py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 mb-6">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                            競合を分析して勝てる構成を作る
                        </button>

                        <!-- 分析結果 -->
                        <div id="competitor-analysis-result" class="hidden">
                            <!-- 必須見出し（競合共通） -->
                            <div class="mb-6">
                                <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                                    <span class="material-symbols-outlined icon-sm text-indigo-600">priority_high</span> 必須見出し（競合が共通で書いている内容）
                                </h3>
                                <p class="text-xs text-gray-500 mb-3">これらの見出しは上位表示に必須。必ず記事に含めてください。</p>
                                <div id="must-have-headings" class="space-y-2"></div>
                            </div>

                            <!-- 差別化見出し候補 -->
                            <div class="mb-6">
                                <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                                    <span class="material-symbols-outlined icon-sm text-indigo-500">add_circle</span> 差別化見出し（一部の競合だけが書いている）
                                </h3>
                                <p class="text-xs text-gray-500 mb-3">取り入れると網羅性UP。競合を超える武器になります。</p>
                                <div id="diff-headings" class="space-y-2"></div>
                            </div>

                            <!-- KCI独自の強み提案 -->
                            <div class="mb-6 bg-indigo-50 rounded-xl p-4">
                                <h3 class="font-bold text-indigo-800 mb-3 flex items-center gap-2">
                                    <span class="material-symbols-outlined icon-sm text-indigo-400">star</span> KCI独自の差別化ポイント（競合にない強み）
                                </h3>
                                <p class="text-xs text-indigo-600 mb-3">これらを追加すれば、競合を圧倒できます。</p>
                                <div id="kci-unique-headings" class="space-y-2"></div>
                            </div>

                            <!-- 推奨見出し構成 -->
                            <div class="mb-6 bg-gradient-to-r from-indigo-50 to-slate-50 rounded-xl p-4 border-2 border-indigo-200">
                                <h3 class="font-bold text-indigo-800 mb-3 flex items-center gap-2">
                                    <span class="material-symbols-outlined icon-sm text-indigo-600">assignment</span> 1位を取るための推奨見出し構成
                                </h3>
                                <div id="recommended-structure" class="bg-white rounded-lg p-4 text-sm"></div>
                                <div class="flex gap-2 mt-4">
                                    <button type="button" onclick="copyRecommendedStructure()" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-semibold">
                                        構成をコピー
                                    </button>
                                    <button type="button" onclick="applyAndSwitchToDesign()" class="flex-1 bg-indigo-500 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-semibold">
                                        構成作成タブに反映
                                    </button>
                                </div>
                            </div>

                            <!-- 競合比較表 -->
                            <details class="mb-6">
                                <summary class="cursor-pointer font-bold text-gray-700 flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                    競合見出し比較表（詳細）
                                </summary>
                                <div id="comparison-table" class="mt-4 overflow-x-auto"></div>
                            </details>
                        </div>
                    </div><!-- /article-main-tab-competitor -->

                </div>
            </div>
        </div><!-- /main-content -->

        <!-- フッター -->
        <footer class="text-center text-sm text-gray-400 mt-8">
            <p>建設業安全教育サイトのSEO記事作成を支援するツールです</p>
        </footer>
    </div>

    <!-- ヘルプボタン -->
    <button class="help-btn" onclick="showHelp()">
        <span class="material-symbols-outlined" style="font-size: 28px; color: white;">help</span>
    </button>

    <!-- ヘルプモーダル -->
    <div class="help-modal" id="help-modal" onclick="if(event.target===this)hideHelp()">
        <div class="help-content">
            <button class="help-close" onclick="hideHelp()">&times;</button>
            <h2><span class="material-symbols-outlined">help</span> SEOキーワード分析ツール ヘルプ</h2>

            <h3>ツールの概要</h3>
            <p>このツールは、SEO記事作成を効率化するためのワンストップ支援ツールです。キーワード分析から記事構成の作成まで、3つのステップで完結します。</p>

            <h3>STEP 0: ビッグキーワード候補</h3>
            <div class="step-box">
                <strong>目的:</strong> ラッコキーワードで検索すべきキーワードを確認
            </div>
            <ul>
                <li>教育テーマ（職長、フルハーネス等）を選択すると、そのテーマに関連するキーワードバリエーションが表示されます</li>
                <li>ボリュームフィルターで、検索ボリュームの範囲を指定できます</li>
                <li>表示されたキーワードを全てラッコキーワードで検索することで、関連キーワードを網羅的に取得できます</li>
            </ul>

            <h3>STEP 1: データ入力</h3>
            <div class="step-box">
                <strong>推奨フロー:</strong> ラッコキーワード → キーワードプランナー → CSV取り込み
            </div>
            <h4>CSV取り込み（推奨）</h4>
            <ul>
                <li>キーワードプランナーからダウンロードしたCSVをドラッグ＆ドロップ</li>
                <li>実際の検索ボリュームに基づいた正確な分析が可能</li>
            </ul>
            <h4>直接入力（簡易モード）</h4>
            <ul>
                <li>ラッコキーワードからコピーしたキーワードを貼り付け</li>
                <li>ボリュームは推定値が自動で割り当てられます（精度は低め）</li>
            </ul>

            <h3>STEP 2: 分析結果</h3>
            <div class="step-box">
                <strong>処理内容:</strong> キーワードを自動でグループ分け（クラスタリング）
            </div>
            <h4>クラスタリングのロジック</h4>
            <ul>
                <li><strong>意味的類似性</strong>: キーワードに含まれる単語の類似性を判定</li>
                <li><strong>検索意図の分類</strong>: Informational（情報収集）、Transactional（行動）、Navigational（案内）に分類</li>
                <li><strong>CV期待度</strong>: 「申込」「受講」「費用」などのキーワードは高CV期待と判定</li>
                <li><strong>一次情報フラグ</strong>: 「体験」「失敗談」などは一次情報として差別化ポイントに</li>
            </ul>
            <h4>エクスポート機能</h4>
            <ul>
                <li><strong>Excel形式</strong>: キーワード・クラスター・優先度をシート別に出力</li>
                <li><strong>JSON形式</strong>: 完全なデータバックアップ（後でインポート可能）</li>
                <li><strong>CSV形式</strong>: シンプルなキーワード一覧</li>
            </ul>

            <h3>STEP 3: 記事設計</h3>
            <div class="step-box">
                <strong>機能:</strong> 記事タイプに応じた構成案を自動生成
            </div>
            <h4>記事タイプ</h4>
            <ul>
                <li><strong>ピラー記事</strong>: 総合ガイド・完全解説。SEO基盤構築、内部リンクのハブとして機能</li>
                <li><strong>ハウツー</strong>: 手順解説・申込み方法。CV率が高い</li>
                <li><strong>選び方ガイド</strong>: 講座紹介・比較。比較検討層を獲得</li>
                <li><strong>FAQ形式</strong>: Q&A・よくある質問。強調スニペット獲得に有効</li>
                <li><strong>事例・体験談</strong>: 受講者の声。E-E-A-T強化</li>
                <li><strong>用語解説</strong>: 基礎知識。初心者獲得に有効</li>
                <li><strong>チェックリスト</strong>: 準備・持ち物。実用性が高くブックマークされやすい</li>
                <li><strong>法改正・ニュース</strong>: 最新情報。専門性アピール</li>
            </ul>
            <h4>プロ向けSEO戦略</h4>
            <ul>
                <li><strong>E-E-A-T</strong>: 経験・専門性・権威性・信頼性を高めるポイント</li>
                <li><strong>CTA設計</strong>: コンバージョンに誘導する配置とテキスト</li>
                <li><strong>内部リンク</strong>: 関連記事への適切なリンク設計</li>
                <li><strong>構造化データ</strong>: FAQSchema等のリッチリザルト対応</li>
                <li><strong>AI差別化</strong>: AI生成コンテンツと差別化するポイント</li>
            </ul>

            <h3>競合分析（任意）</h3>
            <p>競合サイトの見出しを入力すると、以下を分析します：</p>
            <ul>
                <li><strong>必須見出し</strong>: 上位表示に必須の共通トピック</li>
                <li><strong>差別化見出し</strong>: 一部の競合だけが書いている内容</li>
                <li><strong>KCI独自の強み</strong>: 競合にない差別化ポイントの提案</li>
            </ul>

            <div class="warning-box" style="background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 8px; padding: 12px 16px; margin: 16px 0;">
                <strong style="color: #b45309;">記事作成時の注意事項</strong>
                <ul style="margin-top: 8px;">
                    <li><strong>ハルシネーション（AI幻覚）の禁止</strong>: AIが生成した内容は必ず事実確認を行ってください。法令の条文番号、料金、講習時間などは公式情報源で確認すること</li>
                    <li><strong>競合サイトの完全コピー禁止</strong>: 競合分析は構成の参考にのみ使用し、文章の丸写しは絶対にしないでください。著作権侵害およびSEOペナルティの対象となります</li>
                    <li><strong>一次情報の追加</strong>: 自社の強み、実際の受講者の声、現場での経験など、オリジナルの情報を必ず追加してください</li>
                    <li><strong>公式情報源の確認</strong>: 厚生労働省、都道府県労働局などの公式サイトで最新情報を確認してください</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        function showHelp() {
            document.getElementById('help-modal').classList.add('show');
        }
        function hideHelp() {
            document.getElementById('help-modal').classList.remove('show');
        }

        // ========== 記事評価プロンプト生成 ==========
        function copyEvaluationPrompt() {
            if (typeof selectedClusterIndex === 'undefined' || selectedClusterIndex === null) {
                alert('グループを選択してください');
                return;
            }
            const cluster = clusters[selectedClusterIndex];
            const mainKw = cluster.keywords[0]?.keyword || cluster.name;
            const subKeywords = cluster.keywords.slice(0, 10).map(k => k.keyword).join('、');

            const prompt = `サービスサイトのお役立ち記事に掲載する文章を評価してください。

【評価対象キーワード】
メインキーワード：${mainKw}
関連キーワード：${subKeywords}

【評価観点】
以下の観点で100点満点で採点してください。

1. **SEO適合性（25点）** - 「${mainKw}」で上位表示される可能性、キーワード配置、検索意図との合致
2. **キーワード最適化（20点）** - メインKW・関連KWの適切な使用、スパムでないか
3. **E-E-A-T（25点）** - 経験・専門性・権威性・信頼性の要素
4. **競合との差別化（15点）** - 独自の価値、一次情報の有無
5. **コンテンツ品質（15点）** - 文字量（3000文字以上推奨）、見出し構造、読みやすさ

【出力形式】
■ 総合評価：○○点/100点
■ 項目別評価（各項目の点数と評価コメント）
■ 改善提案（優先度順）
■ 良い点

---
以下に評価対象の記事を貼り付けてください：
`;

            navigator.clipboard.writeText(prompt).then(() => {
                alert('評価プロンプトをコピーしました！\\n\\nAIに貼り付けて、その後に評価したい記事を貼り付けてください。');
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = prompt;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('評価プロンプトをコピーしました！');
            });
        }

        // ========== スコア詳細の折りたたみ ==========
        function toggleScoreDetail() {
            const section = document.getElementById('score-detail-section');
            const toggleText = document.getElementById('score-toggle-text');
            const toggleIcon = document.getElementById('score-toggle-icon');
            if (section.classList.contains('hidden')) {
                section.classList.remove('hidden');
                toggleText.textContent = '閉じる';
                toggleIcon.textContent = 'expand_less';
            } else {
                section.classList.add('hidden');
                toggleText.textContent = '詳細';
                toggleIcon.textContent = 'expand_more';
            }
        }

        // ========== AI選択同期 ==========
        function syncAISelect(value) {
            const radios = document.querySelectorAll('input[name="ai-select"]');
            radios.forEach(r => r.checked = (r.value === value));
        }

        // ========== SEO採点機能 ==========
        function runSEOScoring() {
            const outline = document.getElementById('article-outline')?.textContent || '';
            const integratedOutline = document.getElementById('article-outline-integrated')?.innerHTML || '';
            const titleSuggestions = document.getElementById('title-suggestions')?.textContent || '';
            const metaDescription = document.getElementById('meta-description')?.textContent || '';
            const primarySources = document.getElementById('primary-sources')?.textContent || '';
            const eeatTips = document.getElementById('pro-tips-eeat')?.textContent || '';
            const ctaTips = document.getElementById('pro-tips-cta')?.textContent || '';

            if (!outline && !integratedOutline) {
                alert('まず「記事構成を生成」を実行してください');
                return;
            }

            const scores = {};
            const suggestions = [];
            let detailReport = '';

            // 1. タイトル最適化 (20点満点)
            scores.title = 0;
            detailReport += '【タイトル最適化】\n';
            if (titleSuggestions) {
                const titleLength = titleSuggestions.split('\n')[0]?.length || 0;
                if (titleLength >= 25 && titleLength <= 40) { scores.title += 10; detailReport += '✓ タイトル文字数が適切\n'; }
                else if (titleLength > 0) { scores.title += 5; suggestions.push('タイトルは25-40文字が最適です'); detailReport += '△ タイトル文字数が最適範囲外\n'; }
                if (/【|】|\[|\]|｜/.test(titleSuggestions)) { scores.title += 5; detailReport += '✓ 記号を使用して視認性を向上\n'; }
                if (/\d{4}年|最新/.test(titleSuggestions)) { scores.title += 5; detailReport += '✓ 年号・最新表記で鮮度をアピール\n'; }
                else { suggestions.push('タイトルに年号を入れると鮮度がアピールできます'); }
            } else { suggestions.push('SEOタイトル案を確認してください'); }

            // 2. メタディスクリプション (15点満点)
            scores.meta = 0;
            detailReport += '\n【メタディスクリプション】\n';
            if (metaDescription) {
                const metaLength = metaDescription.length;
                if (metaLength >= 80 && metaLength <= 160) { scores.meta += 8; detailReport += '✓ 文字数が適切\n'; }
                else if (metaLength > 0) { scores.meta += 4; suggestions.push('メタディスクリプションは80-160文字が最適です'); }
                if (/申込|受講|無料|最短|オンライン/.test(metaDescription)) { scores.meta += 7; detailReport += '✓ アクション喚起ワードを含む\n'; }
                else { suggestions.push('メタディスクリプションにCTA要素を追加しましょう'); }
            }

            // 3. 見出し構造 (20点満点)
            scores.headings = 0;
            detailReport += '\n【見出し構造】\n';
            const h2Count = (outline.match(/^##\s/gm) || integratedOutline.match(/<h2/gi) || []).length;
            const h3Count = (outline.match(/^###\s/gm) || integratedOutline.match(/<h3/gi) || []).length;
            if (h2Count >= 4 && h2Count <= 10) { scores.headings += 10; detailReport += '✓ H2見出し数が適切\n'; }
            else if (h2Count > 0) { scores.headings += 5; if (h2Count < 4) suggestions.push('H2見出しを増やすと網羅性が向上します'); }
            if (h3Count >= 5) { scores.headings += 10; detailReport += '✓ H3見出しで詳細な構造化\n'; }
            else if (h3Count > 0) { scores.headings += 5; }

            // 4. E-E-A-T要素 (20点満点)
            scores.eeat = 0;
            detailReport += '\n【E-E-A-T要素】\n';
            const content = outline + integratedOutline + eeatTips;
            if (/体験|実際に|現場|受講者の声/.test(content)) { scores.eeat += 5; detailReport += '✓ Experience要素を含む\n'; }
            else { suggestions.push('経験要素を追加しましょう'); }
            if (/専門|資格|講師|法令|厚生労働省/.test(content)) { scores.eeat += 5; detailReport += '✓ Expertise要素を含む\n'; }
            if (/運営会社|認定|公式|実績/.test(content)) { scores.eeat += 5; detailReport += '✓ Authoritativeness要素を含む\n'; }
            if (/安心|信頼|サポート|保証/.test(content)) { scores.eeat += 5; detailReport += '✓ Trust要素を含む\n'; }

            // 5. CTA設計 (10点満点)
            scores.cta = 0;
            detailReport += '\n【CTA設計】\n';
            if (/CTA|申込|お申し込み|今すぐ|無料|ボタン/.test(content + ctaTips)) { scores.cta += 5; detailReport += '✓ CTAの配置を考慮\n'; }
            else { suggestions.push('CTAの配置を検討しましょう'); }
            if (/複数|導入部|まとめ|各セクション/.test(ctaTips)) { scores.cta += 5; detailReport += '✓ 複数箇所へのCTA配置\n'; }

            // 6. 一次情報・差別化 (15点満点)
            scores.differentiation = 0;
            detailReport += '\n【一次情報・差別化】\n';
            if (primarySources && primarySources.length > 20) { scores.differentiation += 5; detailReport += '✓ 一次情報源を参照\n'; }
            else { suggestions.push('公式情報源を参照に追加しましょう'); }
            if (/独自|オリジナル|KCI|自社|当社/.test(content)) { scores.differentiation += 5; detailReport += '✓ 独自コンテンツ要素を含む\n'; }
            if (/FAQ|よくある質問|Q&A/.test(content)) { scores.differentiation += 5; detailReport += '✓ FAQセクションを含む\n'; }
            else { suggestions.push('FAQセクションを追加すると強調スニペット獲得の可能性が上がります'); }

            // 総合スコア計算
            const totalScore = scores.title + scores.meta + scores.headings + scores.eeat + scores.cta + scores.differentiation;
            const percentage = Math.round((totalScore / 100) * 100);

            // 記事品質スコア（タイトル+メタ+見出しのみ）
            const articleScore = scores.title + scores.meta + scores.headings;
            const articleMax = 55;
            const articlePercentage = Math.round((articleScore / articleMax) * 100);

            let articleGrade, articleGradeColor;
            if (articlePercentage >= 90) { articleGrade = 'S'; articleGradeColor = '#3b82f6'; }
            else if (articlePercentage >= 80) { articleGrade = 'A'; articleGradeColor = '#3b82f6'; }
            else if (articlePercentage >= 70) { articleGrade = 'B'; articleGradeColor = '#60a5fa'; }
            else if (articlePercentage >= 60) { articleGrade = 'C'; articleGradeColor = '#f59e0b'; }
            else { articleGrade = 'D'; articleGradeColor = '#ef4444'; }

            let grade, gradeColor;
            if (percentage >= 90) { grade = 'S'; gradeColor = '#22c55e'; }
            else if (percentage >= 80) { grade = 'A'; gradeColor = '#22c55e'; }
            else if (percentage >= 70) { grade = 'B'; gradeColor = '#84cc16'; }
            else if (percentage >= 60) { grade = 'C'; gradeColor = '#f59e0b'; }
            else { grade = 'D'; gradeColor = '#ef4444'; }

            // コンパクトスコア表示（常に表示）
            const articleCompact = document.getElementById('article-score-compact');
            const totalCompact = document.getElementById('total-score-compact');
            if (articleCompact) articleCompact.textContent = articleScore;
            if (totalCompact) totalCompact.textContent = totalScore;

            // 記事品質スコア表示（詳細内）
            const articleRing = document.getElementById('article-score-ring');
            if (articleRing) {
                const articleOffset = 151 - (articlePercentage / 100) * 151;
                articleRing.style.stroke = articleGradeColor;
                articleRing.style.strokeDashoffset = articleOffset;
            }
            const articleValueEl = document.getElementById('article-score-value');
            if (articleValueEl) articleValueEl.textContent = articleScore;
            const articleGradeEl = document.getElementById('article-score-grade');
            if (articleGradeEl) { articleGradeEl.textContent = articleGrade; articleGradeEl.style.color = articleGradeColor; }

            // 総合スコアリング表示（詳細内）
            const ringProgress = document.getElementById('score-ring-progress');
            if (ringProgress) {
                const offset = 151 - (percentage / 100) * 151;
                ringProgress.style.stroke = gradeColor;
                ringProgress.style.strokeDashoffset = offset;
            }
            const totalValueEl = document.getElementById('total-score-value');
            if (totalValueEl) totalValueEl.textContent = totalScore;
            const gradeEl = document.getElementById('score-grade');
            if (gradeEl) { gradeEl.textContent = grade; gradeEl.style.color = gradeColor; }

            // 項目別スコア（ミニ表示）
            const scoreData = [
                { score: scores.title, max: 20 },
                { score: scores.meta, max: 15 },
                { score: scores.headings, max: 20 },
                { score: scores.eeat, max: 20 },
                { score: scores.cta, max: 10 },
                { score: scores.differentiation, max: 15 }
            ];
            const scoreItemsMini = document.querySelectorAll('#score-items .score-item-mini');
            scoreItemsMini.forEach((item, i) => {
                const data = scoreData[i];
                const pct = Math.round((data.score / data.max) * 100);
                const valueDiv = item.querySelector('div:last-child');
                if (valueDiv) {
                    valueDiv.textContent = data.score + '/' + data.max;
                    valueDiv.className = 'font-bold ' + (pct >= 80 ? 'text-emerald-600' : pct >= 50 ? 'text-amber-600' : 'text-red-600');
                }
            });

            const suggestionsEl = document.getElementById('score-suggestions');
            if (suggestionsEl) {
                suggestionsEl.innerHTML = suggestions.length > 0 ? suggestions.map(s => '<li>• ' + s + '</li>').join('') : '<li>改善点はありません</li>';
            }
        }
    </script>

    <!-- v4: エクスポートモーダル -->
    <div id="export-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">エクスポート</h2>
                    <button type="button" onclick="closeExportModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>
                <p class="text-sm text-gray-600 mb-4">出力形式を選択してください</p>
                <div class="space-y-3">
                    <button onclick="exportExcel()" class="w-full p-4 border-2 border-indigo-200 rounded-xl hover:bg-indigo-50 text-left flex items-center gap-3">
                        <span class="material-symbols-outlined icon-xl text-indigo-600">table_chart</span>
                        <div>
                            <div class="font-semibold text-indigo-700">Excel形式 (.xlsx)</div>
                            <div class="text-xs text-gray-500">キーワード・クラスター・優先度をシート別に出力</div>
                        </div>
                    </button>
                    <button onclick="exportJSON()" class="w-full p-4 border-2 border-indigo-200 rounded-xl hover:bg-indigo-50 text-left flex items-center gap-3">
                        <span class="material-symbols-outlined icon-xl text-indigo-600">folder</span>
                        <div>
                            <div class="font-semibold text-indigo-700">JSON形式</div>
                            <div class="text-xs text-gray-500">完全なデータバックアップ（後でインポート可能）</div>
                        </div>
                    </button>
                    <button onclick="exportMarkdown()" class="w-full p-4 border-2 border-indigo-200 rounded-xl hover:bg-indigo-50 text-left flex items-center gap-3">
                        <span class="material-symbols-outlined icon-xl text-indigo-600">edit_note</span>
                        <div>
                            <div class="font-semibold text-indigo-700">マークダウン形式</div>
                            <div class="text-xs text-gray-500">記事構成案をMarkdown形式で出力</div>
                        </div>
                    </button>
                    <button onclick="exportCSV()" class="w-full p-4 border-2 border-gray-200 rounded-xl hover:bg-gray-50 text-left flex items-center gap-3">
                        <span class="material-symbols-outlined icon-xl text-slate-500">assignment</span>
                        <div>
                            <div class="font-semibold text-gray-700">CSV形式</div>
                            <div class="text-xs text-gray-500">シンプルなキーワード一覧</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- v4: インポートモーダル -->
    <div id="import-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">インポート</h2>
                    <button type="button" onclick="closeImportModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>
                <p class="text-sm text-gray-600 mb-4">以前にエクスポートしたJSONファイルを読み込みます</p>
                <div id="import-dropzone" class="w-full h-40 border-2 border-dashed border-indigo-300 rounded-xl flex flex-col items-center justify-center bg-indigo-50 hover:bg-blue-100 cursor-pointer transition-colors">
                    <svg class="w-12 h-12 text-blue-400 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                    <p class="text-indigo-700 font-medium">JSONファイルをドロップ、またはクリックして選択</p>
                    <input type="file" id="import-file-input" accept=".json" class="hidden">
                </div>
                <div class="mt-4 p-3 bg-slate-50 rounded-lg text-xs text-indigo-700">
                    <strong>注意:</strong> インポートすると現在のデータは上書きされます
                </div>
            </div>
        </div>
    </div>

    <!-- v4: クラスター編集モーダル -->
    <div id="cluster-edit-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">クラスター編集</h2>
                    <button type="button" onclick="closeClusterEditModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>
                <p class="text-sm text-gray-600 mb-4">キーワードをドラッグ＆ドロップでクラスター間を移動できます</p>
                <div class="mb-4 flex gap-2">
                    <button onclick="addCustomCluster()" class="bg-indigo-500 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm">+ 新規クラスター追加</button>
                </div>
                <div id="cluster-edit-container" class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- 動的に生成 -->
                </div>
                <div class="mt-6 flex justify-end gap-3">
                    <button onclick="closeClusterEditModal()" class="px-6 py-2 border rounded-lg hover:bg-gray-50">キャンセル</button>
                    <button onclick="saveClusterEdits()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg">変更を保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- AIプロンプトモーダル -->
    <div id="ai-modal" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="ai-modal-title" class="text-xl font-bold">AIに送るプロンプト</h2>
                    <button type="button" onclick="closeAIModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                </div>
                <p id="ai-modal-description" class="text-sm text-gray-600 mb-4">以下のプロンプトをコピーしてAIに貼り付けてください</p>
                <textarea id="ai-prompt" class="w-full h-64 p-4 border rounded-xl text-sm font-mono" readonly></textarea>
                <div class="flex gap-3 mt-4">
                    <button type="button" onclick="copyAIPrompt()" class="btn-primary text-white px-6 py-2 rounded-lg flex-1">プロンプトをコピー</button>
                    <a id="ai-link" href="https://claude.ai/" target="_blank" class="bg-gray-100 px-6 py-2 rounded-lg text-center hover:bg-gray-200">AIを開く</a>
                </div>
            </div>
        </div>
    </div>

    <script src="keyword-tool-v4-data.js"></script>
    <script src="keyword-tool-v4-app.js"></script>
    <script>
        // 外部JSファイルの読み込み確認
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                if (typeof loadSampleData !== 'function') {
                    console.error('外部JSファイルの読み込みに失敗しました');
                    alert('エラー: JavaScriptファイルを読み込めませんでした。\n\n' +
                          '【解決方法】\n' +
                          '1. keyword-tool-v4.html（単体版）をお使いください\n' +
                          '   → こちらは外部ファイル不要で動作します\n\n' +
                          '2. または、ローカルサーバーを起動してください\n' +
                          '   → ターミナルで以下を実行:\n' +
                          '   cd ' + location.pathname.replace(/[^/]+$/, '') + '\n' +
                          '   python -m http.server 8000\n' +
                          '   → ブラウザで http://localhost:8000 を開く');
                }
            }, 500);
        });
    </script>
</body>
</html>
